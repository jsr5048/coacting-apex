!function(a,b){"use strict";var c='<div class="apex-rds-container" id="apex_lto_rds"><ul class="apex-rds"></ul></div>',d='<div class="a-LiveTemplateOptions--info"><span class="t-Icon fa fa-info-circle"></span><span class="a-LiveTemplateOptions--info-message"></span></div>',e=window.apex_img_dir,f=["apex_ui/css/core/Property.css","apex_ui/css/core/PropertyEditor.css","apex_ui/css/core/PropertyGroup.css","apex_ui/css/theme/standard/Property.css","apex_ui/css/theme/standard/PropertyEditor.css","apex_ui/css/theme/standard/PropertyGroup.css"],g=["APEX.LTO.COMMON","APEX.LTO.ADVANCED","APEX.LTO.NO_OPTIONS_FOUND","APEX.LTO.NOT_APPLICABLE","APEX.LTO.LIVE_TEMPLATE_OPTIONS","APEX.LTO.CANCEL","APEX.LTO.SAVE"],h=0,i=!1,j=[],k=!1,l={getValues:function(){return apex.templateOptionsHelper.getValuesFromDialog(this.properties,this.propertyEditor.el$).join(":")},resetClasses:function(){"undefined"!=typeof this.el$[0]&&(this.el$[0].className=this.originalClassName)},destroy:function(){this.hasOptions&&this.propertyEditor.el$.propertyEditor("destroy"),this.propertyEditor.el$.remove()}},m=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};m.prototype=l,a.widget("apex.liveTemplateOptions",{options:{componentId:"",data:{},onSave:function(a){a()}},_resetClassNames:function(){this.components.forEach(function(a){a.resetClasses()})},_destroyComponents:function(){this.components.forEach(function(a){a.destroy()}),a("#apex_lto_rds").remove()},_buildComponents:function(){var c=this.options,d=this,e=!0;return this.components=[],c.data.forEach(function(e,f){var g=function(){var b=a(".lto"+c.componentId+"_"+f);return b.length<=0&&(b=a(".lto"+c.componentId+"_"+f,a("iframe").contents())),b},h=g(d.element),i=apex.templateOptionsHelper.getProperties(e,(e.currentValues||"").split(":")),j=function(){return h[0]?h[0].className:""},k=new m({title:e.title,defaultValues:e.defaultValues,properties:i,propertyEditor:{el:"",options:{propertySet:[{displayGroupId:"common",displayGroupTitle:b.getMessage("APEX.LTO.COMMON"),properties:i.common},{displayGroupId:"advanced",displayGroupTitle:b.getMessage("APEX.LTO.ADVANCED"),properties:i.advanced}]}},el$:h,originalClassName:j(),hasOptions:i.common[0].metaData.lovValues.length>0});d.components.push(k)}),e},_render:function(){var e=this.element,f=this,g=a(c),i=a(d);a("body").append(g);var j=g.find(".apex-rds");this.components.forEach(function(c){var d=c.el$,e="liveTemplateOptionsTab"+h++;j.append("<li><a href='#"+e+"'>"+c.title+"</a></li>");var f=c.propertyEditor.el$=a("<div id='"+e+"'>");return g.append(f),c.hasOptions?(f.propertyEditor({data:c.propertyEditor.options,change:function(a,b){var e=function(a){var b=!1,d=(a||"").split(":").filter(function(a){return"#DEFAULT#"!==a||(b=!0,!1)}).join(" ");return b&&(d+=" "+c.defaultValues.join(" ")),d},f=function(){var a=function(a){b.property.value===b.property.originalValue?a.removeClass("is-changed").removeClass("has-warning"):(a.addClass("is-changed"),b.property.requires_reload&&a.addClass("has-warning"))};a(b.property$)},g=e(b.property.value),h=e(b.previousValue);f(),d.removeClass(h),d.addClass(g)}}),""===c.originalClassName?void f.html("<div class='a-LiveTemplateOptions--inner-message'>"+b.getMessage("APEX.LTO.NOT_APPLICABLE")+"</div>"):void 0):void f.html("<div class='a-LiveTemplateOptions--inner-message'>"+b.getMessage("APEX.LTO.NO_OPTIONS_FOUND")+"</div>")}),this.components.length>1?j.aTabs({classPrefix:"apex-rds",showAllScrollOffset:function(){return!1}}):j.hide();var l,m=!1,n=this.options;g.dialog({resizable:!0,draggable:!0,modal:!0,width:400,maxHeight:640,dialogClass:"a-LiveTemplateOptions utr utr-main",title:b.getMessage("APEX.LTO.LIVE_TEMPLATE_OPTIONS"),position:k||{my:"left top",at:"right top",of:e,collision:"flipfit"},close:function(){apex.navigation.endFreezeScroll(),e.css({"z-index":"",position:""}),e.parentsUntil("body").each(function(){var b=a(this);"fixed"===b.css("position")&&b.css("z-index","")}),m?a(window).trigger("apexwindowresized"):f._resetClassNames(),f.destroy(),a("#apexDevToolbar").css("z-index",""),f._destroyComponents(),l.remove()},beforeClose:function(){var b=l.offset();k=[b.left-a(window).scrollLeft(),b.top-a(window).scrollTop()]},open:function(){l||(l=g.parents(".ui-dialog")),apex.navigation.beginFreezeScroll();var b=parseInt(l.next(".ui-front").css("z-index"))+1;e.css({"z-index":b,position:"relative"}),e.parentsUntil("body").each(function(){var c=a(this);"fixed"===c.css("position")&&c.css("z-index",b)}),l.css("z-index",b+1),a("#apexDevToolbar").css("z-index",b-2)},buttons:[{text:b.getMessage("APEX.LTO.CANCEL"),"class":"utr-container__button",click:function(){g.dialog("close")}},{text:b.getMessage("APEX.LTO.SAVE"),"class":"ui-button--hot utr-container__button",click:function(){var a=[];f.components.forEach(function(b,c){b.hasOptions&&a.push(b.getValues())}),n.onSave(a,function(){m=!0,g.dialog("close")},function(a,b,c){alert(JSON.parse(a.responseText).addInfo||JSON.parse(a.responseText).error||c),apex.debug(a)})}}]}),g.parents(".ui-dialog").first().find(".ui-dialog-buttonpane").append(i)},_create:function(){var a=this,b=function(){return a._buildComponents()?void a._render():void a.destroy()};i&&jQuery().propertyEditor&&jQuery().aTabs&&apex.templateOptionsHelper?b():(j.push(b),i||n())}});var n=a.apex.liveTemplateOptions.preload=function(){if(!i){i=!0;var c=a("head"),d=0===apex.debug.getLevel(),h=function(a){c.append("<link rel='stylesheet' href='"+e+a+"' />")};f.forEach(h),a('link[href$="apex_ui/theme_roller/utr.css"]').length<=0&&h("apex_ui/theme_roller/utr.css"),b.loadMessagesIfNeeded(g,function(){a.when(a.getScript(e+"apex_ui/js/"+(d?"minified/widget.propertyEditor.min.js":"widget.propertyEditor.js")),a.getScript(e+"libraries/apex/"+(d?"minified/widget.apexTabs.min.js":"widget.apexTabs.js")),a.getScript(e+"apex_ui/js/"+(d?"minified/templateOptionsHelper.min.js":"templateOptionsHelper.js"))).done(function(){for(apex.templateOptionsHelper.addGeneralPropertyType();j.length>0;){var a=j.pop();a&&a()}})})}}}(apex.jQuery,apex.lang);