!function(a,b,c,d){"use strict";function e(a){return d.getMessage("LOV_DIALOG."+a)}var f="a-PopupLOV",g=f+"-search",h=f+"-filters",i=f+"-filterGroup",j=i+"--lineFilter",k=f+"-filterLabel",l=f+"-filterItem",m=l+"-label",n=l+"-select",o=l+"-text",p=f+"-results",q=f+"-resultsSet",r=f+"-resultsGrid",s=r+"-wrap",t=q+"-link",u=f+"-iconGrid-item",v="a-SearchBox",w=v+"-field",x=v+"-icon",y=v+"-input",z="a-Icon",A="icon-search",B="icon-right-chevron",C="a-Button",D=C+"--noLabel",E=C+"--withIcon",F=C+"--slim",G=C+"--pillEnd",H=C+"--primary",I="a-Form-label",J="a-Form-field",K="a-Form-select",L="apex-button-group",M="apex-item-grid-row",N="apex-item-option",O="visuallyhidden",P="u-textRight",Q="u-textLeft",R="u-textCenter",S="table";a.widget("apex.lovDialog",a.ui.dialog,{version:"5.2",widgetEventPrefix:"lovdialog",baseId:null,filterHasSubFilter:[],filterIsSearch:[],filterFiltersOnChange:[],currentFilters:{},deferredFilterLov:a.Deferred(),options:{filterLov:null,idPrefix:null,multiValue:!1,filters:[],columnDefinitions:[],resultsDisplay:S},_create:function(){var b,c=this.options;if(!a.isFunction(c.filterLov))throw"Missing required 'filterLov' option.";if(0===c.columnDefinitions.length)throw"Missing required 'columnDefinitions' option.";this.baseId=(c.idPrefix||this.element[0].id||"lovDialog")+"_",this.element.addClass(f);for(var e=0;e<this.options.columnDefinitions.length;e++)this.options.columnDefinitions[e]=a.extend({alignment:"left",escape:!0},this.options.columnDefinitions[e]);return this.filterHasSubFilter=[],this.filterIsSearch=[],this.filterFiltersOnChange=[],this.currentFilters={},this.resultsDisplayTableMode=this.options.resultsDisplay===S,this.options.closeText=d.getMessage("APEX.DIALOG.CLOSE"),b=this._super(),this._renderLovDialog(),b},_renderLovDialog:function(){var c,d,g,h,i,j,k=this,l=b.htmlBuilder();if(l.markup("<div").attr("class",f).markup(">"),this._renderFilters(l,this.options.filters),l.markup("<div").attr("class",p).markup(">"),this.resultsDisplayTableMode){for(l.markup("<table").attr("class",q).attr("id",k.baseId+"lovEntries").markup(">").markup("<caption").attr("class",O).markup(">").content(e("LOV_ENTRIES")).markup("</caption>"),l.markup("<tr>"),this.options.multiValue&&l.markup("<th>").content(e("SELECT")).markup("</th>"),c=0;c<this.options.columnDefinitions.length;c++)j=this.options.columnDefinitions[c].title,i="left"===this.options.columnDefinitions[c].alignment?Q:R,l.markup("<th").attr("class",i).optionalAttr("width",this.options.columnDefinitions[c].width).markup(">"),this.options.columnDefinitions[c].escape?l.content(j):l.markup(j),l.markup("</th>");l.markup("</tr>"),l.markup("</table>")}else l.markup("<div").attr("class",s).markup("><ul").attr("class",r).markup("></ul></div>");for(l.markup("</div>"),this.element.empty().append(l.toString()),this._lovEntries$=a("#"+this.baseId+"lovEntries"),this._filterLov(this.options.filters),this._on({click:this._resultsLinkClick}),d=0;d<this.filterIsSearch.length;d++)this._on("#"+this.filterIsSearch[d]+"_button",{click:this._doSearch}),this._on("#"+this.filterIsSearch[d],{keypress:function(a){13===a.which&&(k._doSearch(a),a.preventDefault())}});for(h=0;h<this.filterFiltersOnChange.length;h++)this._on("#"+this.filterFiltersOnChange[h],{change:this._doSearch});for(g=0;g<this.filterHasSubFilter.length;g++)this._on("#"+this.filterHasSubFilter[g],{change:this._filterHasSubFilterChange})},_resultsLinkClick:function(b){var c,d,e,f,g=a(b.target),h=!1;if(g.hasClass(t)){c=this.lovEntries[g.data("lov-entry-idx")];for(var i in this.currentFilters){for(d=0;d<this.options.filters.length;d++)if(this.options.filters[d].name===i){if(h=!0,this.options.filters[d].lov)for(e=0;e<this.options.filters[d].lov.length;e++)if(this.options.filters[d].lov[e].value===this.currentFilters[i]){this.options.filters[d].lov[e].valueFormatting&&(f=this.options.filters[d].lov[e].valueFormatting);break}break}if(h)break}f&&a.extend(c,{valueFormatting:f}),this._trigger("valueSelected",{},c),this.options.multiValue===!1&&this.close()}},_doSearch:function(a){this._filterLov(this.options.filters)},_filterHasSubFilterChange:function(c){for(var d=b.htmlBuilder(),e=this.options.filters,f=a(c.target),g=f.data("filter-name"),h=0;h<e.length;h++)if(e[h].name===g)for(var j=0;j<e[h].lov.length;j++)if(e[h].lov[j].filters)if(f.val()===e[h].lov[j].value)this._renderFilters(d,e[h].lov[j].filters,!0),f.closest("div."+i).after(d.toString());else for(var k=0;k<e[h].lov[j].filters.length;k++)this.element.find("[data-filter-name="+e[h].lov[j].filters[k].name+"]").closest("div."+i).remove()},_filterLovEntries:function(a){var b,c,d,e,f=[];if(""!==a){for(d=a instanceof RegExp?a:new RegExp(a,"i"),b=0;b<this.lovEntries.length;b++)for(c=0;c<this.options.columnDefinitions.length;c++)if(e=this.lovEntries[b][this.options.columnDefinitions[c].name]+"",e.match(d)){f.push(this.lovEntries[b]);break}this.lovEntries=f}},_renderLovEntries:function(a,c){var d,f,g,h,i,j,k=b.htmlBuilder(),l=this;if(this.lovEntries=a.slice(),c&&this._filterLovEntries(c),this.resultsDisplayTableMode){for(d=0;d<this.lovEntries.length;d++){for(k.markup("<tr>"),this.options.multiValue&&k.markup("<td>").markup("<input").attr("type","checkbox").attr("title",e("SELECT")).attr("data-lov-row",d).markup(" />").markup("</td>"),f=0;f<this.options.columnDefinitions.length;f++)i=this.options.columnDefinitions[f].cellFormatting?function(a){k.markup(l.options.columnDefinitions[f].cellFormatting(a))}:this.options.columnDefinitions[f].escape?function(a){k.content(a)}:function(a){k.markup(a)},h=this.lovEntries[d][this.options.columnDefinitions[f].name],h=0!==h?h||"":h,"left"===this.options.columnDefinitions[f].alignment?g=Q:"right"===this.options.columnDefinitions[f].alignment?g=P:"center"===this.options.columnDefinitions[f].alignment&&(g=R),k.markup("<td").attr("class",g).markup(">"),0===f?(k.markup("<a").attr("class",t).attr("href","#").attr("data-lov-entry-idx",d).markup(">"),i(h),k.markup("</a>")):i(h),k.markup("</td>");k.markup("</tr>")}this._lovEntries$.find("tr").after(k.toString())}else{for(d=0;d<this.lovEntries.length;d++)k.markup("<li").attr("class",u).markup(">"),h=this.lovEntries[d].r,j=this.lovEntries[d].d,h=0!==h?h||"":h,k.markup("<a").attr("class",t).attr("href","#").attr("data-lov-entry-idx",d).markup(">"),k.markup("<span").attr("class","fa "+h).attr("aria-hidden","true").markup("></span>"),k.content(j),k.markup("</a>"),k.markup("</li>");this.element.find("."+r).append(k.toString())}},_updateCurrentFilters:function(b){var c,d,e,f;for(c=0;c<b.length;c++)if(d=b[c].name,a("#"+this.baseId+d).length>0&&(e=a("#"+this.baseId+b[c].name),a.inArray(b[c].type,["text","select","search"])>-1?f=e.val():"buttonset"===b[c].type&&(f=e.find("input:checked").val()),this.currentFilters[d]=f,b[c].lov))for(var g=0;g<b[c].lov.length;g++)b[c].lov[g].value===f&&b[c].lov[g].filters&&this._updateCurrentFilters(b[c].lov[g].filters)},_filterLov:function(c){var d,e=this;e.deferredFilterLov.reject({status:0},"superseded",null),e.deferredFilterLov=a.Deferred().always(function(){b.delayLinger.finish("lovDialog",function(){d.remove()})}).done(function(a,b){e._renderLovEntries(a,b)}),this.resultsDisplayTableMode?this._lovEntries$.find("tr").not(":first").remove():this.element.find("."+r).empty(),this._updateCurrentFilters(c),b.delayLinger.start("lovDialog",function(){d=b.showSpinner(a(".a-PopupLOV-results"))}),this.options.filterLov(this.currentFilters,function(a,b){e.deferredFilterLov.resolve(a,b)})},_renderSearch:function(a,b){a.markup("<div").attr("class",g).markup(">"),a.markup("<div").attr("class",v).markup(">"),a.markup("<div").attr("class",w).markup(">"),a.markup("<span").attr("class",x).markup(">"),a.markup("<span").attr("class",z+" "+A).markup(">").markup("</span>"),a.markup("</span>"),a.markup("<input").attr("id",this.baseId+b.name).attr("data-filter-name",b.name).attr("type","text").attr("class",y).attr("title",b.title).attr("placeholder",b.title).attr("aria-controls",this.baseId+"lovEntries").attr("value",b.defaultValue?b.defaultValue:"").optionalBoolAttr("aria-required",b.isRequired).markup(" />"),a.markup("</div>"),a.markup("<button").attr("class",C+" "+D+" "+E+" "+F+" "+G+" "+H).attr("value",e("GO")).attr("type","button").attr("id",this.baseId+b.name+"_button").attr("title",e("GO")).attr("aria-controls",this.baseId+"lovEntries").markup(">"),a.markup("<span").attr("class",z+" "+B).markup(">").markup("</span>"),a.markup("<span").attr("class",O).markup(">").content("Go").markup("</span>"),a.markup("</button>"),a.markup("</div>"),a.markup("</div>"),this.filterIsSearch.push(this.baseId+b.name)},_renderText:function(a,b){a.markup("<div").attr("class",i+" "+j).markup(">"),a.markup("<span").attr("class",k).markup(">"),a.markup("<label").attr("for",this.baseId+b.name).attr("class",I+" "+m).markup(">").content(b.title).markup("</label>"),a.markup("</span>"),a.markup("<span").attr("class",l).markup(">"),a.markup("<input").attr("id",this.baseId+b.name).attr("data-filter-name",b.name).attr("type","text").attr("class",J+" "+o).attr("value",b.defaultValue?b.defaultValue:"").optionalBoolAttr("aria-required",b.isRequired).markup(" />"),a.markup("</span>"),a.markup("</div>")},_renderSelect:function(a,b){function c(c){var d=b.defaultValue===c.value;a.markup("<option").attr("value",c.value).optionalAttr("selected",d).markup(">").content(c.display).markup("</option>"),c.filters&&(this.filterHasSubFilter.push(this.baseId+b.name),d&&(f=c.filters))}var d,f=[];for(this.filterFiltersOnChange.push(this.baseId+b.name),a.markup("<div").attr("class",i+" "+j).markup(">"),a.markup("<span").attr("class",k).markup(">"),a.markup("<label").attr("for",this.baseId+b.name).attr("class",I+" "+m).markup(">").content(b.title).markup("</label>"),a.markup("</span>"),a.markup("<span").attr("class",l).markup(">"),a.markup("<select").attr("id",this.baseId+b.name).attr("data-filter-name",b.name).attr("size","1").attr("class",J+" "+K+" "+n).attr("aria-controls",this.baseId+"lovEntries").optionalBoolAttr("aria-required",b.isRequired).markup(">"),b.isRequired||c({display:e("SELECT_VALUE"),value:""}),d=0;d<b.lov.length;d++)c(b.lov[d]);return a.markup("</select>"),a.markup("</span>"),a.markup("</div>"),f},_renderButtonSet:function(a,b){var c,d,e=[];for(this.filterFiltersOnChange.push(this.baseId+b.name),a.markup("<div").attr("class",i+" "+j).markup(">"),a.markup("<span").attr("class",l+" "+L).attr("id",this.baseId+b.name).attr("role","group").attr("aria-label",b.title).attr("aria-controls",this.baseId+"lovEntries").markup(">"),a.markup("<div").attr("class",M).markup(">"),c=0;c<b.lov.length;c++)d=b.defaultValue===b.lov[c].value,a.markup("<div").attr("class",N).markup(">"),a.markup("<input").attr("id",this.baseId+b.name+"_"+b.lov[c].value).attr("type","radio").optionalAttr("checked",d).attr("value",b.lov[c].value).attr("name",this.baseId+b.name).attr("data-filter-name",b.name).markup(" />"),a.markup("<label").attr("for",this.baseId+b.name+"_"+b.lov[c].value).markup(">").content(b.lov[c].display).markup("</label>"),a.markup("</div>"),b.lov[c].filters&&(this.filterHasSubFilter.push(this.baseId+b.name),d&&(e=b.lov[c].filters));return a.markup("</div>"),a.markup("</span>"),a.markup("</div>"),e},_renderFilters:function(a,b,c){var d,e=[];for(b.length>0&&!c&&a.markup("<div").attr("class",h).markup(">"),d=0;d<b.length;d++){switch(e=[],b[d].type){case"search":this._renderSearch(a,b[d]);break;case"text":this._renderText(a,b[d]);break;case"select":e=this._renderSelect(a,b[d]);break;case"buttonset":e=this._renderButtonSet(a,b[d])}e.length>0&&this._renderFilters(a,e,!0)}b.length>0&&!c&&a.markup("</div>")},close:function(){return this.element.removeClass(f).empty(),this._super()}})}(apex.jQuery,apex.util,apex.debug,apex.lang);