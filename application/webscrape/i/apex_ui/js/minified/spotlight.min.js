$(function(){"use strict";!function(a,b,c,d,e){var f=$v("pFlowId");if(window.self!==window.top||"4050"===f)return!1;if("undefined"!=typeof pe)var g=pe;var h,i={redirect:"redirect",searchPage:"search-page",searchApp:"search-app",searchAllApps:"search-all-apps",go2Page:"goto-page",go2App:"goto-app",pe:"pe",shortcutAction:"shortcutAction"},j={app:"icon-edit-app",page:"icon-page",search:"icon-search",shared:"icon-shared-components",nav:"icon-goto-group",pe:"icon-page-designer"},k=".",l="a-Spotlight",m="a-Spotlight-input",n="a-Spotlight-results",o="is-active",p="a-Spotlight-shortcut",q="spotlight-search",r="a-Spotlight-label",s="sp-aria-match-found",t="sp-result-list",u=a.ui.keyCode,v=50,w=50,x=$v("pInstance"),y=$v("F4000_P1_FLOW")||$v("P4500_CURRENT_APP")||apex.builder.gApplicationId,z=a(k+l).length>0,A=[],B={},C="",D=function(){var a={4e3:"builder",4500:"builder",4800:"teamdev",4350:"admin"};return a[f]}(),E=d.formatMessage,F={app:d.getMessage("SL.APP"),page:d.getMessage("SL.PAGE"),placeHolder:d.getMessage("SL.PLACEHOLDER"),oneMatchFound:d.getMessage("SL.MATCH.FOUND"),noMatchFound:d.getMessage("SL.NO.MATCH.FOUND"),enterKeywords:"Please enter at least two letters to search"},G=function(a){var b;return b=isNaN(a.split(":")[0])?a:"f?p="+a+":"+x},H=function(a){var b,c,d=a.title,e=a.desc||"",f=a.url,g=a.type,h=a.icon,i=a.shortcut,j=i?'<span class="'+p+'" >'+i+"</span>":"",k="",l=a.peData;if((0===f||f)&&(k='data-url="'+f+'" '),g&&(k=k+' data-type="'+g+'" '),l)for(b in l)l.hasOwnProperty(b)&&(k=k+" data-"+b+'="'+l[b]+'" ');return c='<li class="a-Spotlight-result a-Spotlight-result--page"><span class="a-Spotlight-link" '+k+'><span class="a-Spotlight-icon" aria-hidden="true"><span class="a-Icon '+h+'"></span></span><span class="a-Spotlight-info"><span class="'+r+'" role="option">'+d+'</span><span class="a-Spotlight-desc">'+e+"</span></span>"+j+"</span></li>"},I=function(b,d){var f,g=b.data("url"),j=b.data("type");switch(j){case i.pe:window.pageDesigner.goToComponent(b.data("typeid"),b.data("componentid"),b.data("propertyid"));break;case i.searchPage:a("#editor_tabs").tabs("option","active",3),a("#P4500_LOCAL_SEARCH").val(C).trigger("change").focus();break;case i.searchApp:c.popup({url:"f?p=4000~8000~"+x+"~~~~P8000_START_SEARCH,P8000_SEARCH~1,"+encodeURIComponent(C)+"&p_sep=~",name:"SEARCH_RESULTS",width:1e3,height:800});break;case i.searchAllApps:c.popup({url:"f?p=4000~8000~"+x+"~~~~FB_FLOW_ID,FB_FLOW_PAGE_ID,P8000_START_SEARCH,P8000_SEARCH~,,1,"+encodeURIComponent(C)+"&p_sep=~",name:"SEARCH_RESULTS",width:1e3,height:800});break;case i.go2App:c.redirect("f?p=4000:1:"+x+"::NO::FB_FLOW_ID,F4000_P1_FLOW,P0_FLOWPAGE:"+g+","+g+","+g);break;case i.go2Page:window.pageDesigner?window.pageDesigner.goToPage(g):c.redirect("f?p=4000:4150:"+x+"::NO::FB_FLOW_PAGE_ID:"+g);break;case i.redirect:c.redirect(G(g));break;case i.shortcutAction:f=e.lookup(g),f.action||f.href?e.invoke(g,d,h):e.toggle(g)}P()},J=function(c,d){var e,f,h,k,l,m,n="",o=function(a){return g.getComponentType(a)},p=function(b,c){var d,e,f,h=o(c);if(d=g.displayTitleSearch(b,c),h)for(f=h.childComponentTypes.length,e=0;e<f;e++)d=a.merge(p(b,h.childComponentTypes[e]),d);return d};for(e=p(c,d),e.length>w&&(e.length=w),l=0,m=e.length;l<m;l++)f=e[l],h=f.typeId,k=o(h),n+=H({title:b.escapeHTML(k.title.singular)+" &rarr; "+b.escapeHTML(f.getDisplayTitle()),icon:j.pe,type:i.pe,peData:{typeid:h,componentid:f.id,propertyid:k.displayPropertyId}});return n},K=function(){a("#"+t).empty(),a(k+m).val("").focus(),C="",L()},L=function(){var b=a(k+n),c=a(k+m),d=b.find(k+o).find(k+r).attr("id"),e=a("#"+d),f=e.text(),g=b.find("li"),h=0!==g.length,i="",j=g.filter(function(){return 0===a(this).find(k+p).length}).length;a(k+r).attr("aria-selected","false"),e.attr("aria-selected","true"),""===C?i=F.enterKeywords:0===j?i=F.noMatchFound:1===j?i=F.oneMatchFound:j>1&&(i=E("SL.N.MATCHES.FOUND",j)),i=f+", "+i,a("#"+s).text(i),c.attr("aria-activedescendant",d).attr("aria-expanded",h)},M=function(){var b,c,d,e,f=function(){var f=a("div.a-Spotlight-results");b=f.outerHeight(),c=a("li.a-Spotlight-result").outerHeight(),d=f.offset().top,e=b/c},g=function(a){if(a[0]){var c=a.offset().top;return c<0||c>b}},h=function(a){if(a[0]){var c=a.offset().top;return c>b||c<=d}},i=function(a){var b,d=a.find(k+o),h=d.index();e||f(),!d.length||d.is(":last-child")?(d.removeClass(o),a.find("li").first().addClass(o),a.animate({scrollTop:0})):(b=d.removeClass(o).next().addClass(o),g(b)&&a.animate({scrollTop:(h-e+2)*c},0))},j=function(a){var b,d=a.find(k+o),g=d.index();e||f(),!a.length||d.is(":first-child")?(d.removeClass(o),a.find("li").last().addClass(o),a.animate({scrollTop:a.find("li").length*c})):(b=d.removeClass(o).prev().addClass(o),h(b)&&a.animate({scrollTop:(g-1)*c},0))};a(window).on("apexwindowresized",function(){f()}),a("body").append('<div class="'+l+'"><div class="a-Spotlight-body"><div class="a-Spotlight-search"><div class="a-Spotlight-icon"><span class="a-Icon icon-search" aria-hidden="true"></span></div><div class="a-Spotlight-field"><input type="text" role="combobox" aria-expanded="false" aria-autocomplete="none" aria-haspopup="true" aria-label="Spotlight Search" aria-owns="'+t+'" autocomplete="off" autocorrect="off" spellcheck="false" class="'+m+'" placeholder="'+F.placeHolder+'"></div><div role="region" class="u-VisuallyHidden" aria-live="polite" id="'+s+'"></div></div><div class="'+n+'"><ul class="a-Spotlight-resultsList" id="'+t+'" tabindex="-1" role="listbox"></ul></div></div></div>').on("input",k+m,function(){var b=a(this).val().trim(),c=b.length;0===c?K():(c>1||!isNaN(b))&&b!==C&&S(b)}).on("keydown",k+l,function(b){var c,d,e=a(k+n);switch(b.which){case u.DOWN:b.preventDefault(),i(e);break;case u.UP:b.preventDefault(),j(e);break;case u.ENTER:b.preventDefault(),I(e.find("li.is-active span"),b);break;case u.TAB:P()}if(b.ctrlKey){switch(c=e.find(k+p).parent().get().reverse(),b.which){case 49:d=1;break;case 50:d=2;break;case 51:d=3;break;case 52:d=4}d&&I(a(c[d-1]),b)}b.shiftKey&&b.which===u.TAB&&P(),L()}).on("click","span.a-Spotlight-link",function(b){I(a(this),b)}).on("mousemove","li.a-Spotlight-result",function(){var b=a(this);b.parent().find(k+o).removeClass(o),b.addClass(o)}).on("blur",k+l,function(b){a(k+l).dialog("isOpen")&&a(k+m).focus()}),a(k+l).on("keydown",function(b){var c=a(k+m);b.which===u.ESCAPE&&(c.val()?(K(),b.stopPropagation()):P())}),z=!0},N=function(a){var b,c,d,f,g,h="";for(A=a,b=e.list(),g=0;g<b.length;g++)d=b[g],f=d.name,f!==q&&(c=e.lookup(f),c&&(h=e.shortcutDisplay(c.shortcut||"")),A.push({n:d.label,d:h,shortcutAction:f,type:i.shortcutAction}))},O=function(b){var d=function(){var b=a(k+l),d=window.scrollY||window.pageYOffset;b.hasClass("ui-dialog-content")&&b.dialog("isOpen")||b.dialog({width:650,height:"auto",modal:!0,position:{my:"center top",at:"center top+"+(d+64),of:a("body")},dialogClass:"ui-dialog--apexspotlight",open:function(){var b=a(this);b.css("min-height","auto").prev(".ui-dialog-titlebar").remove(),c.beginFreezeScroll(),a(".ui-widget-overlay").on("click",function(){P()})},close:function(){K(),c.endFreezeScroll()}})};z?d():(M(),d(),apex.server.process("spotlightIndex",{x01:y},{success:function(a){N(a)},error:function(a){}})),h=b},P=function(){a(k+l).dialog("close")},Q=function(a){var b,c,d=encodeURIComponent(C),e=C,f=/^(\d+)(?::|-)(\d+)$/,h=/^(\d+)(?::|-)[Ss]$/,k=function(a){var b=B[a],c="";return c=b?b+" ("+a+")":a};if(f.test(C)?(c=C.match(f),a.push({n:E("SL.EDIT.PAGE.IN.APP",c[2],c[1]),u:"f?p=4000:4500:"+x+"::NO::FB_FLOW_ID,FB_FLOW_PAGE_ID:"+c[1]+","+c[2],icon:j.page,type:i.redirect})):h.test(C)&&(c=C.match(h),a.push({n:E("SL.SHARED.COMP.APP",c[1]),u:"f?p=4000:9:"+x+"::NO::FB_FLOW_ID:"+c[1],icon:j.shared,d:"Go to Shared components",type:i.redirect})),!isNaN(e)){if(0===Object.keys(B).length)for(var l=0;l<A.length;l++)b=A[l],b.appId&&(B[b.appId]=b.n);y&&a.push({n:E("SL.EDIT.PAGE.IN.APP",e,k(y)),icon:"icon-edit",pageId:e}),a.push({n:E("SL.GO.TO.APP",k(e)),icon:j.app,appId:e})}switch(D){case"builder":(y||g)&&(g&&a.push({n:E("SL.SEARCH.PAGE",e),type:i.searchPage,icon:j.search,shortcut:"Ctrl + 4"}),a.push({n:E("SL.SEARCH.APP",e),type:i.searchApp,icon:j.search,shortcut:"Ctrl + 3"}));break;case"teamdev":a.push({n:E("SL.SEARCH.TEAM.DEV",e),u:"f?p=4800:8000:"+x+":::RIR:IR_ROWFILTER:"+d,icon:j.search,type:i.redirect});break;case"admin":a.push({n:E("SL.SEARCH.USER",e),u:"f?p=4350:8000:"+x+":::RIR:IR_ROWFILTER:"+d,icon:"icon-user",type:i.redirect})}return a.push({n:E("SL.SEARCH.ALLAPPS",e),type:i.searchAllApps,icon:j.search,shortcut:"Ctrl + 2"}),a.push({n:E("SL.SEARCH.WP",e),u:"f?p=4500:8000:"+x+":::RIR:IR_ROWFILTER:"+d,icon:j.search,type:i.redirect,shortcut:"Ctrl + 1"}),a},R=function(a){var b,c,d=[],e=!1,f=a.length,g=function(){return e?d:A},h=function(a,b,c){var d,e=100,f=b-1;return 0===a&&0===f?e:(d=c.indexOf(C),d===-1?e=e-a-f-b:e-=d,e)};for(c=0;c<a.length;c++)b=a[c],d=g().filter(function(a,c){var d=a.n.toLowerCase(),e=d.split(" ").length,g=d.search(b);return!(f>e)&&(g>-1?(a.score=h(g,e,d),!0):a.t&&a.t.search(b)>-1?(a.score=1,!0):void 0)}).sort(function(a,b){return b.score-a.score}),e=!0;var k=function(a){var b,c,d,e,f,g,h,k="",l={};for(a.length>v&&(a.length=v),b=0;b<a.length;b++)c=a[b],h=c.shortcut,c.appId?(f=i.go2App,e=c.appId,d="",g=j.app):0===c.pageId||c.pageId?(f=i.go2Page,e=c.pageId,d=F.app+" "+y+" &#92; "+F.page+" "+e,g=j.page):(f=c.type||i.redirect,e=c.u||c.shortcutAction,d=c.d,g=c.icon||j.nav),l={title:c.n,desc:d,url:e,icon:g,type:f},h&&(l.shortcut=h),k+=H(l);return k.replace("{APP_ID}",y)};return k(Q(d))},S=function(c){var d="sp-result-";C=c.trim();var e,f,h=C.split(" "),i=(a(k+n),[]),j="";for(f=0;f<h.length;f++)i.push(new RegExp(b.escapeRegExp(h[f]),"gi"));e=R(i),g&&g.getCurrentPageId()&&(j=J(i[0],g.COMP_TYPE.PAGE)),a("#"+t).html(j+e).find("li").each(function(b){var c=a(this);c.find(k+r).attr("id",d+b)}).first().addClass(o)};e.add({name:q,label:null,title:null,shortcut:"Ctrl+Quote",action:function(a,b){return O(b),!0}})}(apex.jQuery,apex.util,apex.navigation,apex.lang,apex.actions)});