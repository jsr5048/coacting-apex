!function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c="";return"start"===a?c=" u-tS":"end"===a?c=" u-tE":"left"===a?c=" u-tL":"right"===a?c=" u-tR":"center"!==a||b||(c=" u-tC"),c}function i(a){var b=a.groupName||null;return b&&a.useGroupFor&&a.useGroupFor.indexOf("srv")<0&&(b=null),b}var j="a-RV",k="a-RV-toolbar",l="a-RV-w-scroll",m="a-RV-body",n="a-RV--excludeHidden",o="a-RV--excludeNull",p="u-Form",q="u-Form-groupHeading",r="u-Form-fieldContainer",s="."+r,t=s+".is-active",u="u-Form-labelContainer",v="u-Form-label",w="."+v,x="u-Form-inputContainer",y="."+x,z="t-Form-error",A="."+z,B=".t-Alert",C="a-RV-field--hidden",D="a-RV-field--null",E="is-focused",F="is-disabled",G="is-active",H="."+G,I="is-required",J="is-readonly",K="is-error",L="is-warning",M="is-error is-warning is-readonly",N="u-RTL",O="aria-labelledby",P=":tabbable",Q="data-itemhelp",R=":visible",S="enable",T="disable",U="option",V="show",W="hide",X="record",Y="table",Z="tree",$="modeChange",_="recordChange",aa="delete-record",ba="duplicate-record",ca="next-record",da="previous-record",ea="exclude-null-values",fa="exclude-hidden",ga="insert-record",ha="refresh-record",ia="revert-record",ja=g.ui.keyCode,ka=[{align:"start",controls:[{type:"MENU",labelKey:"APEX.RV.SETTINGS_MENU",iconOnly:!0,icon:"icon-gear",menu:{items:[{type:"toggle",action:ea},{type:"toggle",action:fa}]}}]},{align:"end",controls:[{type:"STATIC",id:"status",label:""},{type:"BUTTON",iconOnly:!0,action:da},{type:"STATIC",id:"recordNumber",label:""},{type:"BUTTON",iconOnly:!0,action:ca}]}];g.widget("apex.recordView",g.apex.tableModelViewBase,{version:"18.1",widgetEventPrefix:"recordview",options:{idPrefix:null,actionsContext:null,recordOffset:0,recordParent:null,showNullAs:"-",fields:null,fieldGroups:null,alwaysEdit:!1,skipDeletedRecords:!1,toolbar:ka,showExcludeNullValues:!0,showExcludeHiddenFields:!0,formCssClasses:null,labelAlignment:"end",modeChange:null,recordChange:null},_create:function(){var a=this,b=this.options,c=this.element;c.addClass(j),this._super(),delete this.firstPage,delete this.previousPage,delete this.nextPage,delete this.lastPage,delete this.loadMore,delete this.gotoPage,this.editMode=!1,this.fields=null,this.excludeNullValues=!1,this.excludeHiddenFields=!1,this.lastFocused=null,this.lastField=null,this.toolbar$=null,this.currentRecord=null,this.currentRecordId=null,b.actionsContext?this.actions=b.actionsContext:this.actions=f.createContext("recordView",c[0]),this.actions.remove([ea,fa,ca,da,ga,ha,ia,aa,ba]),this.actions.add([{name:ea,labelKey:"APEX.RV.EXCLUDE_NULL",get:function(){return a.excludeNullValues},set:function(d){b.showExcludeNullValues&&(a.excludeNullValues=d,c.toggleClass(o,d))}},{name:fa,labelKey:"APEX.RV.EXCLUDE_HIDDEN",get:function(){return a.excludeHiddenFields},set:function(d){b.showExcludeHiddenFields&&(a.excludeHiddenFields=d,c.toggleClass(n,d))}},{name:ca,labelKey:"APEX.RV.NEXT_RECORD",shortcut:"Alt+Page Down",icon:"icon-next",action:function(){var c,d;if(a.modelShape===Z){if(d=a._nextTreeRecord(),!d)return;b.recordParent=d.parent,b.recordOffset=d.offset}else{if(c=a.model.getTotalRecords(),!(c<0||b.recordOffset+1<c))return;b.recordOffset+=1}a.direction=1,a.refresh(!1)}},{name:da,labelKey:"APEX.RV.PREV_RECORD",shortcut:"Alt+Page Up",icon:"icon-prev",action:function(){var c;if(a.modelShape===Z){if(c=a._previousTreeRecord(),!c)return;b.recordParent=c.parent,b.recordOffset=c.offset}else{if(!(b.recordOffset>0))return;b.recordOffset-=1}a.direction=-1,a.refresh(!1)}},{name:ga,labelKey:"APEX.RV.INSERT",action:function(){if(b.editable)return a.model.insertNewRecord(a.modelShape===Z?b.recordParent:null,a.getRecord()),a.actions.invoke(ca),a.editMode||a.setEditMode(!0),a.focus(),!0}},{name:ha,labelKey:"APEX.RV.REFRESH",action:function(){b.editable&&a.model.fetchRecords([a.getRecord()])}},{name:ia,labelKey:"APEX.RV.REVERT",action:function(){b.editable&&a.model.revertRecords([a.getRecord()])}},{name:aa,labelKey:"APEX.RV.DELETE",action:function(){b.editable&&a.model.deleteRecords([a.getRecord()])}},{name:ba,labelKey:"APEX.RV.DUPLICATE",action:function(){if(b.editable){var c=a.getRecord();return a.model.copyRecords([c],null,c),a.actions.invoke(ca),a.editMode||a.setEditMode(!0),a.focus(),!0}}}]),this._updateMenuActions(),this._initModel(b.modelName),this._on(this._eventHandlers),this.direction=1,this.refresh(),b.disabled&&this._setOption("disabled",b.disabled)},_eventHandlers:{resize:function(a){a.target===this.element[0]&&(this.resize(),a.stopPropagation())},dblclick:function(a){var b=this.options,c=g(a.target).closest(s);c.length&&!b.alwaysEdit&&b.editable&&!this.editMode&&(a.preventDefault(),this.setEditMode(!0))},click:function(a){var b,c=g(a.target).closest(w);c.length&&(b=c.closest(s),b.find(P).first().focus())},keydown:function(a){var b,c,d,e=this.options,f=a.which;if(f===ja.ENTER){if(g(a.target).closest("a,button").length>0)return;b=g(a.target).closest(s),b.length&&!e.alwaysEdit&&e.editable&&!this.editMode&&(a.preventDefault(),this.setEditMode(!0))}else if(113===f)b=g(a.target).closest(s),b.length&&!e.alwaysEdit&&e.editable&&!this.editMode&&(a.preventDefault(),this.setEditMode(!0));else if(f===ja.ESCAPE)!e.alwaysEdit&&e.editable&&this.editMode&&(g(a.target).closest(y).focus(),this.setEditMode(!1),a.stopPropagation());else if(112===f&&a.altKey&&(b=g(a.target).closest(s),c=b.find(".js-itemHelp"),c.length&&(d=c.attr(Q))))return apex.theme.popupFieldHelp(d,$v("pInstance")),!1},focusin:function(a){function b(){e.deactivateDelayTimer&&(clearTimeout(e.deactivateDelayTimer),e.deactivateDelayTimer=null)}var c,d,e=this,f=g(a.target);return d=f.closest(s),0===d.length?void(this.lastField=null):(d.addClass(E),this.lastFocused=d[0],d[0]===this.lastField?void b():(this.lastField=d[0],void(this.editMode&&(b(),c=this.element.find(H),c.length&&this._deactivateField(c),this._activateField(d)))))},focusout:function(a){var b=this,c=g(a.target).closest(s);0!==c.length&&(c.removeClass(E),this.editMode&&(this.deactivateDelayTimer=setTimeout(function(){b.lastField=null,b._deactivateField(c),b.deactivateDelayTimer=null},10)))}},_destroy:function(){this.element.removeClass(j+" "+F+" "+N+" "+n+" "+o).empty(),this._initModel(null)},_setOption:function(a,b){"editable"===a&&!b&&this.editMode&&this.setEditMode(!1),this._super(a,b),"disabled"===a?(this.element.toggleClass(F,b),b&&this.resize()):"showExcludeNullValues"===a||"showExcludeHiddenFields"===a?this._updateMenuActions():"recordOffset"===a||"recordParent"===a?this.refresh():"modelName"===a?(this.editMode&&this.setEditMode(!1),this._initModel(b),this.refresh()):"editable"!==a&&"alwaysEdit"!==a&&"toolbar"!==a&&"formCssClasses"!==a&&"labelAlignment"!==a||this._refreshView()},getActions:function(){return this.actions},getToolbar:function(){return this.toolbar$},refresh:function(a){var b,c=this,d=this.options,e=this.element;return null===e[0].offsetParent?void(this.pendingRefresh=!0):(this.pendingRefresh=!1,b=e.find(t),b.length&&this._deactivateField(b),this.fields||this._initView(),!this.editMode&&d.alwaysEdit&&this.setEditMode(!0),void this._updateRecord(null,null,function(){a&&c.focus()}))},focus:function(){this.lastField=null,this.body$.find(P).first().focus()},gotoField:function(a,b){var d,e,f,g,h,i=this.options,j=null;if(e=this.model.getRecord(a),!e)return void c.warn("Warning record not found "+a);if(a!==this.currentRecordId&&(i.recordOffset=this.model.indexOf(e),this.refresh()),b)if(g=i.fields[0][b]){for(g.hidden&&g.canHide&&this.excludeHiddenFields&&this.actions.set(fa,!1),h=this.model.getValue(e,b),null!==h&&""!==h||!this.excludeNullValues||this.actions.set(ea,!1),d=0;d<this.fields.length;d++)if(f=this.fields[d],!(f.virtual||!f.canHide&&f.hidden)&&f.property===b){j=this.element.find("[data-idx='"+d+"']");break}d>=this.fields.length&&c.warn("Warning column is hidden "+b)}else c.warn("Warning column not found "+b);j?(this.lastField=null,j.find(P).first().focus()):this.focus()},refreshFields:function(){this.fields=null},fieldElement:function(a){return this.mapFieldToLabelId&&this.mapFieldToLabelId[a]?g("#"+this.mapFieldToLabelId[a]).closest(s):g()},inEditMode:function(){return this.editMode},setEditMode:function(a){var b,d,e,f=this.element,h=this,i="change.rvedit";this.scrollWrap$&&(this.options.editable?(a=!!a,e=this.editMode,b=a!==e,b&&(d=g(this.lastFocused),this._updateRecord(a,e,function(){h.editMode=a,f.toggleClass("a-RV--editMode",a),d.length&&(d.find(P).first().focus(),h.deactivateDelayTimer&&(clearTimeout(h.deactivateDelayTimer),h.deactivateDelayTimer=null),a?h._activateField(d):h._deactivateField(d)),a?h.body$.on(i,function(a){var b,c,d;if(h.activeRecord&&!g(a.target).closest(t).length)for(b=0;b<h.fields.length;b++)if(c=h.fields[b],c.elementId===a.target.id){d=c.property,h.setActiveRecordValue(d);break}}):(h.body$.off(i),h.activeRecord=null,h.activeRecordId=null),h._trigger($,null,{editMode:a})}))):a&&c.warn("View is not editable."))},getRecord:function(){return this.currentRecord},resize:function(){var a,b=this.element,c=b.height();null!==b[0].offsetParent&&(this.scrollWrap$&&!this.pendingRefresh||(this.refresh(),this.fields))&&this.options.hasSize&&(a=c-(this.toolbar$?this.toolbar$.outerHeight():0),this.scrollWrap$.height(a))},expandGroup:function(a){},collapseGroup:function(a){},_initModel:function(b){function c(b,c){function g(a,g){var h,i;for(h=0;h<a.length;h++)i=a[h],i===f.currentRecordId&&("delete"===b?d&&e.skipDeletedRecords?(f.currentRecord=null,f.currentRecordId=null,f.activeRecord=null,f.activeRecordId=null,f.actions.invoke(ca),null===f.currentRecord&&f.actions.invoke(da)):f._updateRecord():"clearChanges"===b&&g?f.actions.invoke(ca):"refreshRecords"===b?(i=c.newIds[i]||i,f._updateRecord()):"revert"===b?f._updateRecord():f._updateRecordState())}var h,i,j,k,l,m;"refresh"===b?(f.modelShape===Z?(f.recordOffset=-1,f.recordParent=null):f.recordOffset=0,f.refresh(!0)):"insert"===b||"copy"===b?f.noData&&f.refresh():"refreshRecords"===b?g(c.recordIds):"clearChanges"===b?(g(c.deletedIds,!0),g(c.changedIds)):c.recordIds?g(c.recordIds):"set"===b?f.ignoreFieldChange||(c.oldIdentity&&f._identityChanged(c.oldIdentity,f.model.getRecordId(c.record)),f.model.getRecordId(c.record)===f.currentRecordId&&(h=f.columnItems[c.field],f.editMode&&h?f.ignoreItemChange||f._setColumnItemValue(h.item,c.record,c.field):(k=f.fieldElement(c.field),k.length&&(j=f._getFieldMetadata(k),l=f.model.getRecordMetadata(f.currentRecordId),m=null,l.fields&&(m=l.fields[j.property]),i=a.htmlBuilder(),f._renderFieldDataValue(i,j,c.record,l,m),k.find(y).html(i.toString()))),f._updateRecordState())):"metaChange"===b&&(f.ignoreFieldChange||c.recordId!==f.currentRecordId||f._updateRecordState())}var d,e=this.options,f=this;this._super(b,c),b&&(d=this.model.getOption("onlyMarkForDelete"),this.modelShape=this.model.getOption("shape"),this.modelShape===X&&(this.actions.hide(ca),this.actions.hide(da),this.actions.hide(ga),this.actions.hide(ba),this.actions.hide(aa)))},_updateMenuActions:function(){var a=this.options;this.actions[a.showExcludeNullValues?V:W](ea),this.actions[a.showExcludeHiddenFields?V:W](fa)},_updateFields:function(){var a,b,c,d=this.options,e={},f=d.fields[0];this.fields=[];for(b in f)f.hasOwnProperty(b)&&(a=f[b],a.property=b,this.fields.push(a),c=i(a),c&&(!e[c]||a.seq<e[c])&&(e[c]=a.seq));this.fields.sort(function(a,b){var c,d;return i(a)===i(b)?a.seq-b.seq:i(a)?i(b)?(c=e[i(a)]||0,d=e[i(b)]||0,c-d):-1:1})},_initView:function(){var a=this.options,b=this.editMode;this._updateFields(),this.columnItems||this._initColumnItems(this.fields),this.toolbar$=null,b&&this.setEditMode(!1),this._renderView(),(b||a.alwaysEdit)&&this.setEditMode(!0),a.toolbar&&(this.toolbar$=this.element.children("."+k).toolbar({idPrefix:this._getIdPrefix()+"tb",actionsContext:this.actions,data:a.toolbar,small:!0}),this.modelShape===X&&this.toolbar$.toolbar("hideControl","recordNumber")),this.resize()},_refreshView:function(){this.refreshFields(),this.refresh()},_forEachField:function(a,b){var c,d,e,f,g,h=this.fields;for(a&&(f=this.element.find(y)),e=0,c=0;c<h.length;c++)d=h[c],d.virtual||!d.canHide&&d.hidden||(g=null,a&&(g=f.eq(e)),b.call(this,c,d,g),e+=1)},_getIdPrefix:function(){return(this.options.idPrefix||this.element[0].id||"rv")+"_"},_renderView:function(){function b(){o.markup("<div").attr("class",p+(j.formCssClasses?" "+j.formCssClasses:"")).markup(">"),e=!0}var c,e,f,j=this.options,n=this.element,o=a.htmlBuilder();j.toolbar&&o.markup("<div class='"+k+"'></div>"),this._renderAltDataMessages(o),o.markup("<div class='"+l+"'>").markup("<div class='"+m+"'>"),this.mapFieldToLabelId={},c=null,e=!1,this._forEachField(!1,function(a,g){var k,l,m,n,p,s,t;if(p=this._getIdPrefix()+a,this.mapFieldToLabelId[g.property]=p,f=i(g),c!==f){if(f){if(l=j.fieldGroups[f],!l)throw new Error("Unknown field group name: "+f);m=l.label||l.heading}else m=d.getMessage("APEX.RV.NOT_GROUPED_LABEL");e&&o.markup("</div>"),o.markup("<h3 class='"+q+"'><button type='button'>").content(m).markup("</button></h3>"),b(),c=f}e||b(),k=r,g.hidden&&(k+=" "+C),g.fieldCssClasses&&(k+=" "+g.fieldCssClasses),g.isRequired&&(k+=" "+I),n=g.label||g.heading,s=null,g.fieldColSpan&&(s=parseInt(g.fieldColSpan,10),s>0&&s<13?o.markup("<div class='apex-col apex-col-"+s+"'>"):s=null),o.markup("<div").optionalAttr("id",g.elementId?g.elementId+"_CONTAINER":null).attr("data-idx",a).attr("class",k).markup("><div").attr("id",p).attr("class",u+" "+h(j.labelAlignment)).markup(">"),o.markup("<span").optionalAttr("id",g.elementId?g.elementId+"_LABEL":null).attr("class",v).markup(">").content(n).markup("</span>"),g.helpid&&(t=d.formatMessage("APEX.ITEM.HELP_TEXT",n),o.markup("<button class='t-Button t-Button--noUI t-Button--helpButton js-itemHelp' tabindex='-1' type='button'").attr(Q,g.helpid).attr("aria-label",t).attr("title",t).markup("><span class='a-Icon icon-help' aria-hidden='true'></span></button>")),o.markup("</div><div tabindex='0' class='"+x+"'").attr(O,g.elementId+"_LABEL").markup("></div></div>"),s&&o.markup("</div>")}),e&&o.markup("</div>"),o.markup("</div></div>"),n.html(o.toString()).find("."+q).each(function(){var a=g(this);a.collapsible({heading:"."+q,controllingElement:"button",universalTheme:!0,collapsed:!1,content:a.next()})}),this.scrollWrap$=n.find("."+l),this.body$=n.find("."+m),this.noData$=n.find(".a-GV-noDataMsg")},_updateRecord:function(a,b,c){function d(){var a,b,c,d,e,f,h;for(e=g.model.getRecordMetadata(g.currentRecordId),a=0;a<g.fields.length;a++)b=g.fields[a].property,c=g.columnItems[b],c&&(h=c.item.isDisabled(),c.element$.is(R)&&!h?(d=c.item.getValidity(),d.valid||g.model.setValidity("error",g.currentRecordId,b,c.item.getValidationMessage())):g.model.setValidity("valid",g.currentRecordId,b),e&&(f=e.fields?e.fields[b]:null,(f&&f.hasOwnProperty("disabled")||h)&&(f||(e.fields||(e.fields={}),f={},e.fields[b]=f),f.disabled=h)));g._triggerEndEditing(g.currentRecord,g.currentRecordId),g.activeRecord=null,g.activeRecordId=null}function e(e,f,j){var k,l,m,n=g.body$;if(e){if(k=g.model.getRecordMetadata(j)||{},g.scrollWrap$.show(),g.noData$.hide(),k.agg||k.deleted&&i.skipDeletedRecords)return g.modelShape===Z?(l=g[g.direction>0?"_nextTreeRecord":"_previousTreeRecord"](),l&&(i.recordParent=l.parent,i.recordOffset=l.offset)):(i.recordOffset+=g.direction,m=g.model.getTotalRecords(),i.recordOffset<0?(i.recordOffset=0,g.direction=-g.direction):m>=0&&i.recordOffset>=m&&(i.recordOffset=m-1,g.direction=-g.direction)),g._updateRecord(a,b,c),void g._updateRecord();i.editable&&g.currentRecord&&(a&&b!==!1||b===!0)&&d(),i.recordOffset=f,g.currentRecordId=j,g.currentRecord=null,g.activeRecord=null,g._renderRecordFields(a,e,f,j,k),g.currentRecord=e,a&&(g.activeRecord=e,g.activeRecordId=j),n.children(B).remove(),n.find(A).remove(),g._updateRecordState(),g._updateRecordNumber(),i.editable&&a&&g._triggerBeginEditing(g.currentRecord,g.currentRecordId),null!==h&&h===g.currentRecordId||setTimeout(function(){g._trigger(_,null,{recordOffset:i.recordOffset,recordId:g.currentRecordId})},1)}else i.editable&&g.currentRecord&&(a&&b!==!1||b===!0)&&d(),g.currentRecordId=null,g.currentRecord=null,g._renderRecordFields(a,null,-1,null,{}),g.scrollWrap$.hide(),g.noData$.show(),g._updateActions(),g._updateRecordNumber()}var f,g=this,h=this.currentRecordId,i=this.options;if(null!==a&&void 0!==a||(a=this.editMode),this.activeLockCount>0)return void(this.activeUnlockCallback=function(){g._updateRecord(a,b,c)});switch(this.modelShape){case X:f=this.model.getRecord(),e(f,0,f?this.model.getRecordId(f):null);break;case Y:this.model.forEachInPage(i.recordOffset,1,function(a,b,c){e(a,b,c)},this);break;case Z:null===i.recordParent?(f=this.model.root(),i.recordOffset=-1,e(f,i.recordOffset,f?this.model.getRecordId(f):null)):(f=this.model.child(i.recordParent,i.recordOffset),e(f,i.recordOffset,f?this.model.getRecordId(f):null))}c&&c()},_renderRecordFields:function(b,c,d,e,f){var g=null,h=!1,i=a.htmlBuilder(),j=this.columnItemsContainer$?this.columnItemsContainer$[0]:null;b&&c&&(h=this.model.allowEdit(c)),this._forEachField(!0,function(a,b,d){var e,k,l,m=!1;e=r,c&&(k=this.model.getValue(c,b.property),null!==k&&""!==k||(e+=" "+D),b.hidden&&(e+=" "+C),b.fieldCssClasses&&(e+=" "+b.fieldCssClasses),b.isRequired&&(e+=" "+I),f.fields&&(g=f.fields[b.property]),g&&(g.disabled&&(e+=" is-disabled"),(g.ck||b.readonly)&&(e+=" "+J,m=!0))),l=this.columnItems[b.property],h&&l&&!m&&!b["volatile"]?l.element$.parent()[0]===j&&(d.empty().append(l.element$).attr("tabindex",-1).removeAttr(O),this._activateColumnItem(l,b.elementId+"_LABEL")):(l&&l.element$.parent()[0]!==j&&(this._deactivateColumnItem(l),d.attr("tabindex",0).attr(O,b.elementId+"_LABEL")),c?(i.clear(),this._renderFieldDataValue(i,b,c,f,g),d.html(i.toString())):d.empty()),d.parent().attr("class",e)}),h&&c&&(this._beginSetColumnItems(),this._forEachField(!0,function(a,b,d){var e=this.columnItems[b.property];!e||d.hasClass(J)||b["volatile"]||this._setColumnItemValue(e.item,c,b.property,h?f:null)}),this._endSetColumnItems())},_updateRecordState:function(){var a,b,c,e,f,h="",i=this.body$;if(b=this.model.getRecordMetadata(this.currentRecordId)||{},i.removeClass("is-deleted is-inserted is-updated "+M),b.deleted?(i.addClass("is-deleted"),h=d.getMessage("APEX.GV.ROW_DELETED")):b.inserted?(i.addClass("is-inserted"),h=d.getMessage("APEX.GV.ROW_ADDED")):b.updated&&(i.addClass("is-updated"),h=d.getMessage("APEX.GV.ROW_CHANGED")),this.model.allowEdit(this.currentRecord)||i.addClass(J),b.error||b.warning?(c=i.children(B),c.length||(c=g("<div class='t-Alert'></div>"),i.prepend(c)),c.text(b.message),i.addClass(b.error?K:L)):i.children(B).remove(),b.fields)for(a in b.fields)b.fields.hasOwnProperty(a)&&(e=b.fields[a],f=this.fieldElement(a),f.removeClass("is-changed "+M),e.error||e.warning?(c=f.find(A),c.length||(c=g("<span class='"+z+"'></span>"),f.find(y).append(c)),c.text(e.message),f.addClass(e.error?K:L)):(f.find(A).remove(),e.changed&&f.addClass("is-changed")),e.ck&&f.addClass(J));this._updateActions(),this.toolbar$&&this.toolbar$.toolbar("findElement","status").text(h)},_hasPrevious:function(){var a=this.options;switch(this.modelShape){case X:return!1;case Y:return a.recordOffset>0;case Z:return null!==this._previousTreeRecord()}},_hasNext:function(){var a,b=this.options;switch(this.modelShape){case X:return!1;case Y:return a=this.model.getTotalRecords(),a<0||b.recordOffset+1<a;case Z:return null!==this._nextTreeRecord()}},_nextTreeRecord:function(){var a,b,c=this.options,d=c.recordOffset,e=c.recordParent;if(b=null===e?this.model.root():this.model.child(e,d),this.model.childCount(b)>0)return{parent:b,offset:0};for(;e;){if(a=this.model.childCount(e),a>0&&d+1<a)return{parent:e,offset:d+1};d=this.model.indexOf(e),e=this.model.parent(e)}return null},_previousTreeRecord:function(){function a(c){var d=b.model.childCount(c);return d>0?a(b.model.child(c,d-1)):{parent:b.model.parent(c),offset:b.model.indexOf(c)}}var b=this,c=this.options,d=c.recordOffset,e=c.recordParent;return null===e?null:e&&d>0?a(this.model.child(e,d-1)):{parent:this.model.parent(e),offset:this.model.indexOf(e)}},_updateActions:function(){function a(a,b){c[a?S:T](b)}var b=this.options,c=this.actions,d=this.currentRecord,e=b.editable,f=this.model,g=this.modelShape===Z?b.recordParent:null,h=e&&f.allowAdd(g,"new"),i=e&&d&&f.allowAdd(g,"copy"),j=e&&d;a(j&&f.canRevertRecord(d),ia),a(j&&f.allowDelete(d),aa),a(h,ga),a(i,ba),a(d&&this._hasNext(),ca),a(d&&this._hasPrevious,da)},_getFieldMetadata:function(a){var b=parseInt(a.attr("data-idx"),10);return isNaN(b)?null:this.fields[b]},_activateField:function(a){var b,c;a.length<=0||null===this.currentRecord||(b=this._getFieldMetadata(a),b&&(c=this.columnItems[b.property]),c&&this.model.allowEdit(this.currentRecord)&&!a.hasClass(J)&&a.addClass(G))},_deactivateField:function(a){var b,c=null;a.length<=0||null===this.currentRecord||(b=this._getFieldMetadata(a),b&&(c=this.columnItems[b.property]),c&&!a.hasClass(J)&&a.hasClass(G)&&(this._setModelValue(a,c.item,this.currentRecord,b.property),this._updateRecordState()))},_updateRecordNumber:function(){var a,b,c="",e=this.options;this.toolbar$&&(this.currentRecord&&(this.modelShape===Z?(b=this.model.parent(this.currentRecord),b&&(a=this.model.childCount(b))):a=this.model.getTotalRecords(),c=a>0?d.formatMessage("APEX.RV.REC_XY",e.recordOffset+1,a):d.formatMessage("APEX.RV.REC_X",e.recordOffset+1)),this.toolbar$.toolbar("findElement","recordNumber").text(c))},_identityChanged:function(a,b){a===this.currentRecordId&&(this.currentRecordId=b,this.activeRecordId&&(this.activeRecordId=b))}}),g.apex.recordView.copyDefaultToolbar=function(){var a,b=[];for(a=0;a<ka.length;a++)b.push(g.extend(!0,{},ka[a]));return b},g.apex.recordView.createModelEditDialog=function(c,e){function h(a){v&&(n&&v.expand(v.getSelection().first()),setTimeout(function(){v[n?"setSelectedNodes":"setSelectedRecords"]([a])},1))}var i,j,k,l,m,n,o,p,q,r,t,u,v,w,x,y=g,z=[],A=y("#"+c),B=a.htmlBuilder();e.appendToTop&&(y=a.getTopApex().jQuery),t=y("body").context,A.length||(A=y("<div id='"+c+"'></div>"),y(e.appendTo||"body").append(A)),(e.modelOptions.shape||Y)===Z?j=g.apex.treeView.makeModelNodeAdapter(e.modelName,e.modelOptions,null):((e.modelOptions.shape||Y)===X&&(z=null),j=b.create(e.modelName,e.modelOptions,z,0,!1)),q=j.getOption("shape"),r=j.getOption("fields"),u=!!j.getOption("sequenceField"),B.markup("<form novalidate><section class='a-IGDialog-region a-IGDialog-body'>"),q!==X&&B.markup("<aside class='a-IGDialog-side resize'><div class='nav resize'></div><div class='tb'></div></aside>"),B.markup("<main class='a-IGDialog-main resize'><div class='rv resize'></div></main></section></form>"),i=g.extend({closeText:d.getMessage("APEX.DIALOG.CLOSE"),noDataMessage:null},e,{autoOpen:!1,modal:!0,buttons:[{text:d.getMessage("APEX.DIALOG.CANCEL"),click:function(){m.recordView("setEditMode",!1),y(this).dialog("close")}},{text:d.getMessage("APEX.DIALOG.SAVE"),"class":"ui-button--hot",click:function(){var a="",b=!0;m.recordView("setEditMode",!1),e.validate&&(b=e.validate.call(this,j),"string"==typeof b&&(a=b+"\n\n",b=!1)),b&&!j.hasErrors()?(e.store&&e.store.call(this,j),y(this).dialog("close")):(m.recordView("refresh"),a+=apex.lang.getMessage("APEX.CORRECT_ERRORS"),apex.message.alert(a,function(){var a=m.find("."+K);a.length||(a=m.find(s).first()),a.find(P).focus()}))}}],create:function(){var a,b,d,i,p=f.createContext("ModelEditDialog",A[0]);if(y(this).closest(".ui-dialog").css("position","fixed"),m=g("#"+c,t).find(".rv"),m.recordView({modelName:e.modelName,noDataMessage:e.noDataMessage,idPrefix:e.idPrefix||e.modelName,fields:[r],actionsContext:p,toolbar:null,editable:!0,alwaysEdit:!0,hasSize:!0,skipDeletedRecords:!0,formCssClasses:e.formCssClasses,labelAlignment:e.labelAlignment,recordChange:function(b,c){var d;"nav"!==a&&(d=m.recordView("getRecord"),d&&(a="rv",h(d),a=null))}}),q!==X&&(o=g("#"+c,t).find(".tb"),p.add([{name:"move-up",labelKey:"APEX.RV.MOVE_UP",hide:!0,action:function(){var a,b=null,c=k.grid("getSelection"),d=k.grid("getSelectedRecords");c[0].prev().length&&(a=c[0].prev().prev(),a.length&&(b=k.grid("getRecords",[a])[0]),j.moveRecords(d,null,b),k.grid("setSelectedRecords",d))}},{name:"move-down",labelKey:"APEX.RV.MOVE_DOWN",hide:!0,action:function(){var a,b=null,c=k.grid("getSelection"),d=k.grid("getSelectedRecords");a=c[c.length-1].next(),a.length&&(b=k.grid("getRecords",[a])[0],j.moveRecords(d,null,b),k.grid("setSelectedRecords",d))}}]),b=[{type:"BUTTON",iconOnly:!0,icon:"icon-plus",action:ga},{type:"BUTTON",iconOnly:!0,icon:"icon-copy",action:ba},{type:"BUTTON",iconOnly:!0,icon:"icon-minus",action:aa},{type:"BUTTON",iconOnly:!0,icon:"icon-up-chevron",action:"move-up"},{type:"BUTTON",iconOnly:!0,icon:"icon-down-chevron",action:"move-down"}],p[e.includeCopy?V:W](ba),p[u?V:W]("move-up"),p[u?V:W]("move-down"),o.toolbar({actionsContext:p,data:[{align:"start",controls:b}]})),q===Y)if(e.useList){if(l=g("#"+c,t).find(".nav"),i=e.recordTemplate,!i){if(!e.labelColumn)throw new Error("Option recordTemplate or labelColumn is required");i="<li data-id='&APEX$ROW_ID.' class='&APEX$ROW_STATE_CLASSES.'>",e.iconClassColumn&&(i+="<span class='a-IconList-icon'><span class='&"+e.iconClassColumn+".'></span></span>"),e.enabledCheckbox&&(i+="<span class='ro-checkbox &\"enabledClass\".'></span><span class='u-vh'>&\"enabledText\".</span>"),i+="<span class='a-IconList-label'>&"+e.labelColumn+".</span></li>"}l.tableModelView({modelName:e.modelName,columns:[r],hasSize:!0,footer:!1,pagination:{scroll:!0},useIconList:!0,recordTemplate:i,collectionClasses:e.collectionClasses||"a-RVDialog-list",selectionChange:function(){var b,c;"rv"!==a&&(c=l.tableModelView("getSelectedRecords")[0],c&&(a="nav",b=j.indexOf(c),m.recordView(U,"recordOffset",b),a=null))}}),v=l.data("apex-tableModelView")}else k=g("#"+c,t).find(".nav"),k.grid({modelName:e.modelName,noDataMessage:e.noDataMessage,columns:[r],editable:!1,hasSize:!0,footer:!1,pagination:{scroll:!0},reorderColumns:!1,columnSort:!1,hideDeletedRows:!0,selectionChange:function(){var b,c;"rv"!==a&&(c=k.grid("getSelectedRecords")[0],c&&(a="nav",b=j.indexOf(c),m.recordView(U,"recordOffset",b),a=null))}}),v=k.data("apex-grid");else q===Z&&(g("#"+c,t).find(".nav").addClass("a-RVDialog-scroll").html("<div class='a-RVDialog-tree'></div>"),n=g("#"+c,t).find(".a-RVDialog-tree"),d={showRoot:!0,collapsibleRoot:!0,expandRoot:!0,getNodeAdapter:function(){return j},selectionChange:function(){var b,c,d;"rv"!==a&&(c=n.treeView("getSelectedNodes")[0],c&&(d=j.parent(c),a="nav",d!==m.recordView(U,"recordParent")&&m.recordView(U,"recordParent",d),b=j.indexOf(c),m.recordView(U,"recordOffset",b),a=null))}},n.treeView(d),g.apex.treeView.treeModelListener(e.modelName,n),v=n.data("apex-treeView"));this.initDone=!1},open:function(){var a,b=null;o&&o.toolbar("refresh"),k&&k.grid("refreshColumns"),i.resize(),e.init&&!this.initDone&&e.init.call(this,j,k||l||n||null,m,o),this.initDone=!0,e.load&&(b=e.load.call(this,j)),q!==X&&(a=b?j.getRecord(b):m.recordView("getRecord"),a&&h(a)),setTimeout(function(){m.recordView("focus")},100)},close:function(){q===Y?j.setData([],0):j.setData(null)},resize:function(){var b=A.width(),c=A.height();p?A.find("section").height(c).width(b).resize():(A.find("section,main,aside").height(c),b-=A.find("aside").outerWidth()||0,A.find("main").width(b),m.width(b),m.height(c).recordView("resize"),b=A.find("aside").width(),c-=A.find(".tb").outerHeight(),k?k.width(b).height(c).grid("resize"):n&&n.width(b).height(c),a.setOuterWidth(A.find(".tb"),b))}}),i.dialogHelp&&i.buttons.unshift({text:d.getMessage("APEX.DIALOG.HELP"),"class":"ui-button-help",click:function(){var a=i.dialogHelp;d.loadMessagesIfNeeded([a.titleKey,a.helpTextKey],function(){var b={title:a.title,helpText:a.helpText};a.titleKey&&(b.title=d.getMessage(a.titleKey)),a.helpTextKey&&(b.helpText=d.getMessage(a.helpTextKey)),apex.theme.popupFieldHelp(b)})}}),i.titleKey&&(i.title=d.getMessage(i.titleKey),delete i.titleKey),A.html(B.toString()).dialog(i).on("dialogopen",function(){apex.navigation.beginFreezeScroll()}).on("dialogresize",function(){y(this).closest(".ui-dialog").css("position","fixed")}).on("dialogclose",function(){apex.navigation.endFreezeScroll()}),A.on("keydown",function(a){var b;a.which===ja.ENTER&&"INPUT"===a.target.nodeName&&(e.defaultButton&&(b=A.parent().find(".ui-button--hot").eq(0).focus(),setTimeout(function(){b.click()},50)),a.preventDefault())}),e.useSplitter&&q!==X&&g.apex.splitter&&(w=e.splitterPosition||200,e.persistSplitter&&(x=apex.storage.getScopedSessionStorage({prefix:"ORA_WWV_apex.MED_"+e.persistSplitter,useAppId:!0}),w=parseInt(x.getItem("splitterPosition")||w,10)),p=A.find(".a-IGDialog-body").splitter({position:w,collapsed:!1,minSize:120,orientation:"horizontal",positionedFrom:"begin",noCollapse:!0,change:function(a,b){x&&x.setItem("splitterPosition",b.lastPosition-b.lastPosition%1+"")}}),A.on("resize",function(b){var c,d,e,f,h=g(b.target);c=h.height(),d=h.width(),e=h.children(".resize").filter(R),e.length>0&&(h.children(":not(.resize)").filter(R).each(function(){f=g(this).css("position"),"fixed"!==f&&"absolute"!==f&&(c-=g(this).outerHeight(!0))}),c=Math.floor(c/e.length),e.each(function(){var b=g(this);a.setOuterHeight(b,c),a.setOuterWidth(b,d),b.filter(R).trigger("resize")})),b.stopPropagation()}));var C=A.data("ui-dialog"),D=C._destroy;return C._destroy=function(){D.call(C),b.destroy(e.modelName)},A}}(apex.util,apex.model,apex.debug,apex.lang,apex.item,apex.actions,apex.jQuery);