function ws_Spreadsheet(a,b){function c(a){return apex.lang.getMessage(a)}function d(a){1==a?$x_Show("apexir_LOADER"):($x_Hide("apexir_LOADER"),reInitWS())}function e(){$("div.edit:not(div.readonly)",$("#"+q.spreadsheet_id)[0]).unbind("click").click(function(a){m(this,a)})}function f(){var a={items:[{type:"action",label:c("PROPERTIES"),hide:!0,icon:"icon-irr-ws-properties",action:function(){q.dialog("WEBSHEET")}},{type:"action",label:c("TOGGLE_CHECKBOXES"),hide:!0,icon:"icon-irr-ws-toggle-checkboxes",action:function(){q.actions("toggle_checkboxes")}},{type:"separator"},{type:"subMenu",label:c("COLUMNS"),hide:!0,icon:"icon-irr-ws-col",menu:{items:[{type:"action",label:c("ADD"),icon:"icon-irr-ws-col-add",action:function(){q.dialog("ADD_COLUMN")}},{type:"action",label:c("COLUMN_PROPERTIES"),icon:"icon-irr-ws-col-pros",action:function(){q.dialog("COLUMN_PROPERTIES")}},{type:"action",label:c("LIST_OF_VALUES"),icon:"icon-irr-ws-lov",action:function(){q.dialog("LOV")}},{type:"action",label:c("COLUMN_GROUPS"),icon:"icon-irr-ws-col-groups",action:function(){q.dialog("GROUP")}},{type:"action",label:c("VALIDATION"),icon:"icon-irr-ws-validation",action:function(){q.dialog("VALIDATION")}},{type:"action",label:c("DELETE_COLUMNS"),icon:"icon-irr-ws-col-delete",action:function(){q.dialog("REMOVE_COLUMN")}}]}},{type:"subMenu",label:c("ROWS"),hide:!0,icon:"icon-irr-ws-row",menu:{items:[{type:"action",label:c("ADD_ROW"),icon:"icon-irr-ws-col-add",action:function(){apex.navigation.redirect(apex.util.makeApplicationUrl({pageId:"20",debug:"NO",clearCache:"20",itemNames:["WS_APP_ID","P20_IR_ID","P20_DATA_GRID_ID","CURRENT_WORKSHEET_ROW"],itemValues:[r.wsAppId,q.spreadsheet_id,r.dataGridId,""]}))}},{type:"action",label:c("SET_COLUMN_VALUES"),icon:"icon-irr-ws-col-values",action:function(){q.dialog("SET_COLUMN_VALUE")}},{type:"action",label:c("REPLACE"),icon:"icon-irr-ws-row-replace",action:function(){q.dialog("REPLACE")}},{type:"action",label:c("FILL"),icon:"icon-irr-ws-row-fill",action:function(){q.dialog("FILL")}},{type:"action",label:c("DELETE_ROWS"),icon:"icon-irr-ws-row-delete",action:function(){q.dialog("DELETE_ROWS")}}]}},{type:"action",label:c("DELETE_DATA_GRID"),hide:!0,icon:"icon-irr-ws-dg-delete",action:function(){q.dialog("DELETE")}},{type:"separator"},{type:"action",label:c("COPY"),hide:!0,icon:"icon-irr-ws-copy",action:function(){q.dialog("COPY")}},{type:"action",label:c("HISTORY"),icon:"icon-irr-ws-history",action:function(){apex.navigation.redirect(apex.util.makeApplicationUrl({pageId:"14",debug:"NO"}))}}],beforeOpen:function(a,b){var c,d=b.menu.items;for(c=0;c<8;c++)d[c].hide=!r.currentUserIsNotReader}};r.websheetManageDatagridMenu&&$("#apexir_WEBSHEETMENU").menu(a);var b={items:[{type:"action",label:c("EDIT_ATTRIBUTES"),action:function(){apex.navigation.redirect(apex.util.makeApplicationUrl({pageId:"3010",debug:"NO",clearCache:"3010",itemNames:["p3010_worksheet_id","p3030_worksheet_id"],itemValues:[q.spreadsheet_id,q.spreadsheet_id]}))}},{type:"action",label:c("EDIT_QUERY"),action:function(){apex.navigation.redirect(apex.util.makeApplicationUrl({pageId:"3030",debug:"NO",clearCache:"3030",itemNames:["p3010_worksheet_id","p3030_worksheet_id"],itemValues:[q.spreadsheet_id,q.spreadsheet_id]}))}}]};r.websheetManageReportMenu&&r.currentUserIsNotReader&&$("#apexir_WEBSHEETMENU").menu(b)}function g(){for(var a=[],b=$x_FormItems(q.spreadsheet_id,"CHECKBOX"),c=0,d=b.length;c<d;c++)b[c].checked&&b[c].id&&(a[a.length]=b[c].value);return a}function h(a){function b(a,b,d,e){var g,h;g=b?b:w.BUTTON.APPLY,d&&(h="ui-button--hot"),f.push({text:g,"class":h,click:function(){q.actions(a),e&&c.dialog("close")}})}var c,d,e,f=[{text:w.BUTTON.CANCEL,click:function(){c.dialog("close")}}];"WEBSHEET"===a?(d=w.DIALOG_TITLE.PROPERTIES,b("websheet_properties_save",null,!0,!1)):"ADD_COLUMN"===a?(d=w.DIALOG_TITLE.ADD_COLUMN,b("column_add",null,!0,!1)):"COLUMN_PROPERTIES"===a?(d=w.DIALOG_TITLE.COLUMN_PROPERTIES,b("column_properties_save",null,!0,!1)):"LOV"===a?(d=w.DIALOG_TITLE.LOV,e=apex.item("apexir_LOV_ID").getValue(),e&&b("lov_delete",w.BUTTON.DELETE,!1,!1),b("lov_save",null,!0,!1)):"GROUP"===a||"GROUP2"===a?(d=w.DIALOG_TITLE.COLUMN_GROUPS,e=apex.item("apexir_GROUP_ID").getValue(),e&&b("column_groups_delete",w.BUTTON.DELETE,!1,!1),b("column_groups_save",null,!0,!1)):"VALIDATION"===a?(d=w.DIALOG_TITLE.VALIDATION,e=apex.item("apexir_VALIDATION_ID").getValue(),e&&b("VALIDATION_DELETE",w.BUTTON.DELETE,!1,!1),b("VALIDATION_SAVE",null,!0,!1)):"REMOVE_COLUMN"===a?(d=w.DIALOG_TITLE.DELETE_COLUMNS,b("column_remove",w.BUTTON.DELETE,!0,!1)):"SET_COLUMN_VALUE"===a?(d=w.DIALOG_TITLE.SET_COLUMN_VALUES,b("set_column_value",null,!0,!1)):"REPLACE"===a?(d=w.DIALOG_TITLE.REPLACE,b("replace_column_value",null,!0,!1)):"FILL"===a?(d=w.DIALOG_TITLE.FILL,b("fill_column_value",null,!0,!1)):"DELETE_ROWS"===a?(d=w.DIALOG_TITLE.DELETE_ROWS,b("delete_rows",w.BUTTON.DELETE,!0,!1)):"COPY"===a?(d=w.DIALOG_TITLE.COPY_DATA_GRID,b("copy",w.BUTTON.COPY,!0,!1)):"DELETE"===a?(d=w.DIALOG_TITLE.DELETE_DATA_GRID,b("delete_websheet",w.BUTTON.DELETE,!0,!1)):"ATTACHMENT"===a?(d=w.DIALOG_TITLE.ADD_FILE,b("ATTACHMENT_SAVE",null,!0,!0)):"NOTE"===a?(d=w.DIALOG_TITLE.ADD_NOTE,b("NOTE_SAVE",null,!0,!1)):"LINK"===a?(d=w.DIALOG_TITLE.ADD_LINK,b("LINK_SAVE",null,!0,!1)):"TAGS"===a&&(d=w.DIALOG_TITLE.ADD_TAGS,b("TAG_SAVE",null,!0,!1)),c=$("#a-IRR-dialog-js",apex.gPageContext$).dialog({modal:!0,dialogClass:"a-IRR-dialog",width:"auto",height:"auto",minWidth:"360",title:d,buttons:f,close:function(){c.dialog("destroy")}})}function i(){$("#a-IRR-dialog-js",apex.gPageContext$).dialog("isOpen")&&$("#a-IRR-dialog-js",apex.gPageContext$).dialog("close")}function j(a,b){var c;if(q.currentValue!=b.value||$(b).hasClass("apex-tabular-form-error")){q.currentValue=$v(b);var d=new htmldb_Get(null,$v("pFlowId"),"APPLICATION_PROCESS=CELL",s);d.AddNameValue("ACTION","SAVE"),d.AddNameValue("ROW",q.currentRow.id.substring(3)),d.AddNameValue("COLUMN",q.currentCol),d.AddNameValue("VALUE",b.value),d.AddNameValue("CHANGE",$(q.currentRow).attr("apex:c"));var e=d.get();if("true"!=e)c=$(b),c.addClass("apex-tabular-form-error"),$("#ajaxMESSAGE").show(),$("#theMESSAGE").html(e),b.focus(),"date"===q.currentColType&&c.datepicker("show");else{c=$(q.currentRow),c.attr("apex:c",parseInt(c.attr("apex:c"))+1);var f=$(b);f.removeClass("apex-tabular-form-error"),$("#ajaxMESSAGE").hide(),n()}d=null}else n()}function k(a,b){v?"true"==a.responseText?($x_Remove("actionsMenu"),q.row($v("apexir_current_row"),b)):($s("apexir_DIALOG_MESSAGE",a.responseText),$x_Show("apexir_DIALOG_MESSAGE")):"true"==a.responseText?"delete_websheet"==b?document.location="f?p="+$v("pFlowId")+":902:"+$v("pInstance")+"::NO:::":"save_checked"==b||("toggle_checkboxes"!=b&&i(),o.trigger("apexrefresh")):($s("apexir_DIALOG_MESSAGE",a.responseText),$x_Show("apexir_DIALOG_MESSAGE"))}function l(a,b){switch(b?a.ajax.addParam("p_widget_action",b):null,b){case"set_geocode":a.ajax.addParam("x01",$v("apexir_SHUTTLE_RIGHT"));break;case"reset_geocode":break;default:"delete_rows"!=b&&"set_column_value"!=b&&"replace_column_value"!=b||a.ajax.addParam("x01",$u_ArrayToString(g(),":")),"column_groups_save"==b&&$("#apexir_SHUTTLE_RIGHT option").prop("selected",!0),v&&a.ajax.addParam("x03","DETAIL"),a.ajax.AddArrayItems2($x_FormItems("a-IRR-dialog-js"),1)}a._get()}function m(a,b){var c,e,f,g,h,i;n(),q.currentRow=a.parentNode.parentNode,q.currentCell=a,q.classArray=a.className.split(" "),q.currentCol=q.classArray[0],q.currentColTest=!isNaN(q.currentCol.substring(1)),q.currentColType=q.classArray[1],q.currentColMaxLength=q.classArray[3],c=$(a).unbind("click"),"text"==q.currentColType&&q.currentColTest?(e=$(a.parentNode).outerWidth(),f=c.text(),c.html("").css("padding","0"),g=$($dom_AddInput(a,"TEXT","","",f)),g.css("width",e).attr("maxlength",q.currentColMaxLength).blur(function(a){j(a,this)}).keypress(function(a){if(13==a.which)return!1}).focus(),q.currentForm=g[0],q.currentValue=f):"textarea"==q.currentColType&&q.currentColTest?(f=c.html(),c.html("").css("padding","0"),h=$($dom_AddTag(a,"TEXTAREA")),h.css("width","100%").val(f).attr("maxlength",q.currentColMaxLength).blur(function(a){j(a,this)}).focus(),q.currentForm=h[0],q.currentValue=f):"date"==q.currentColType&&q.currentColTest?(e=$(a.parentNode).outerWidth(),f=c.text(),c.html("").css("padding","0"),g=$($dom_AddInput(a,"TEXT","theCal","",f)),g.css("width",e),q.currentForm=g[0],q.currentValue=f,i=new apex.ajax.ondemand("get_dtFmt",function(){var a=p.readyState;if(1==a);else if(2==a);else if(3==a);else{if(4!=a)return!1;var b=apex.jQuery.parseJSON(p.responseText);apex.widget.datepicker("#theCal",{buttonText:"Calendar",showTime:b.showTime,time24h:b.time24h,timeFormat:b.timeFormat,defHour:b.defHour,defMinute:b.defMinute,defAmpm:b.defAmpm,defaultDate:apex.util.getDateFromISO8601String(b.defaultDate),showOn:"focus",showAnim:"drop",showOtherMonths:!1,changeMonth:!1,changeYear:!1,onClose:function(a,b){j(null,this)}},b.dtFmt,b.lang),g.focus(),d(a)}}),d(1),i.ajax.AddNameValue("COLUMN",q.currentCol),i.ajax.AddNameValue("DATE",f),i._get()):"selectlist"==q.currentColType&&q.currentColTest?(f=c.text(),$s(q.currentCell,""),apex.server.process("GET_LOV_JSON",{x01:q.spreadsheet_id,x02:q.currentCol},{dataType:"html",success:function(a){var b=new $d_LOV_from_JSON;b.l_Type="SELECT",b.create(c.parent()[0],a),$s(b.l_Dom,f),b.l_Dom.focus(),b.l_Dom.id="removeMe",$(b.l_Dom).one("blur",function(a){j(a,this)})}}),q.currentValue=f):n()}function n(){$("#removeMe").remove(),$(q.currentCell).text(q.currentValue).css("padding","").unbind("click").one("click",function(){m(this)}),q.currentRow=!1,q.currentCell=!1,q.currentForm=!1,q.currentCol=!1}var o,q=this,r=b,s=$("#pFlowStepId").val(),t="2"===s||"3000"===s,u="2"===s,v="20"===s;r&&r.regionId&&(o=$("#"+r.regionId,apex.gPageContext$)),this.spreadsheet_id=!!a&&a,this.currentRow=!1,this.classArray=!1,this.currentCell=!1,this.currentForm=!1,this.currentCol=!1,this.currentColType=!1,this.spinner$;var w={BUTTON:{CANCEL:c("CANCEL"),DELETE:c("DELETE"),APPLY:c("APPLY"),COPY:c("COPY")},DIALOG_TITLE:{PROPERTIES:c("DATA_GRID_PROPERTIES"),ADD_COLUMN:c("ADD_COLUMN"),COLUMN_PROPERTIES:c("COLUMN_PROPERTIES"),LOV:c("LIST_OF_VALUES"),COLUMN_GROUPS:c("COLUMN_GROUPS"),VALIDATION:c("VALIDATION"),DELETE_COLUMNS:c("DELETE_COLUMNS"),SET_COLUMN_VALUES:c("SET_COLUMN_VALUES"),REPLACE:c("REPLACE"),FILL:c("FILL"),DELETE_ROWS:c("DELETE_ROWS"),COPY_DATA_GRID:c("COPY_DATA_GRID"),DELETE_DATA_GRID:c("DELETE_DATA_GRID"),ADD_FILE:c("ADD_FILE"),ADD_NOTE:c("ADD_NOTE"),ADD_LINK:c("ADD_LINK"),ADD_TAGS:c("ADD_TAGS")}};this.closeUpload=function(){$("#P20_X").attr("name","P20_X"),$x_Remove("actionsMenu"),$("#wwvFlowForm").removeAttr("target"),q.row($v("apexir_current_row"))},this.actions=function(a,b){var c;if(v)if("ATTACHMENT_SAVE"==a){""===$("#apexir_FILE_BUTTON").val()&&$("#P20_X").removeAttr("name"),$s("P20_DESC",$v("apexir_DESCRIPTION")),$x("apexir_DIALOG_MESSAGE").innerHTML='<iframe name="myNewWin" id="myNewWin" height="100" width="20" style="display:none;"></iframe>',q.spinner$=apex.util.showSpinner($("#a-IRR-dialog-js")),$x("wwvFlowForm").target="myNewWin";window.setTimeout(function(){apex.submit("ATTACHMENT")},500)}else c=new apex.ajax.ondemand("websheet_detail",function(){var b=p.readyState;if(1==b);else if(2==b);else if(3==b);else{if(4!=b)return!1;k(p,a),d(b)}}),d(1),b?c.ajax.addParam("p_widget_action_mod",b):null,l(c,a);else c=new apex.ajax.ondemand("websheet",function(){var b=p.readyState;if(1==b);else if(2==b);else if(3==b);else{if(4!=b)return!1;k(p,a),d(b)}}),d(1),l(c,a)},this.dialog=function(a,b,c){var e=new apex.ajax.ondemand("DIALOG",function(){var b=p.readyState;if(1==b);else if(2==b);else if(3==b);else{if(4!=b)return!1;var c=p.responseText;if("LOV_TEXT"==a)$s("apexir_LOV_ENTRIES",c);else{$("#apex_popup_field_help").dialog("isOpen")&&$("#apex_popup_field_help").dialog("close"),$("#a-IRR-dialog-js",apex.gPageContext$).html(c),h(a),$x("apexir_SHUTTLE_LEFT")&&(window.g_Shuttlep_v01=new dhtml_ShuttleObject("apexir_SHUTTLE_LEFT","apexir_SHUTTLE_RIGHT")),"NOTIFY"==a&&$("#apexir_NOTIFY_INTERVAL").change(function(){$f_Hide_On_Value_Item(this,"apexir_DATEPICKERS","I")}).change();var e=$(":input:visible",$("#a-IRR-dialog-js",apex.gPageContext$));e.length>0&&e[0].focus()}d(b)}});d(1),e.ajax.AddNameValue("DIALOG",a),e.ajax.AddNameValue("VALUE",b),e.ajax.AddNameValue("VALUE2",c),v&&e.ajax.AddNameValue("MODE","DETAIL"),e._get()},this.collectCheckedRows=function(a){$f_CheckFirstColumn(a),q.actions("save_checked")},this.selectTest=function(a){switch($v(a)){case"NEW":$x_Show("apexir_LOV_ATTRIBUTES");break;case"":$x_Hide("apexir_LOV_ATTRIBUTES");break;case"NEW_CURRENT_VALUES":$x_Hide("apexir_LOV_ATTRIBUTES");break;default:q.dialog("LOV_TEXT",$v(a)),$s("apexir_LOV_NAME",$f_SelectedOptions(a).text),$x_Show("apexir_LOV_ATTRIBUTES")}},this.row=function(a,b){var c,e,f,g,h,j,k=[];for(d(1),h=new htmldb_Get(null,$v("pFlowId"),"APPLICATION_PROCESS=ITEM_ROW",s),h.add("GOTO_WORKSHEET_ROW",a,50),void 0!==b?h.addParam("x01",b):h.addParam("x01",""),c=$("#row")[0],e=$("input:text,input:hidden,textarea,select",c),f=$(":radio:checked",c),g=$(e).add(f),j=0;j<g.length;j++)k[0]=$(g)[j],h.AddArrayItems(k,parseInt($(k[0]).attr("name").substr(1),10));h.GetAsync(function(a){var b,c,e,f=a.readyState;if(1==f);else if(2==f);else if(3==f);else{if(4!=f)return!1;b=a.responseText,c="error"===b.substr(0,5),$x_Remove("MESSAGE"),c?(e=b.substr(6),$("#ajaxMESSAGE").show(),$("#theMESSAGE").html(e)):($("#ajaxMESSAGE").hide(),$("#drop").html(b)),d(f)}}),i(),h=null},u&&(e(),o.on("apexafterrefresh.datagrid",function(){e()})),v&&($(document).on("click","#apexir_FILE_BUTTON, #apexir_FILE_LABEL",function(a){$("#P20_X").trigger("click"),a.preventDefault()}),$("#P20_X").on("change",function(a){var b;a.target.files.length>0?(b=a.target.files[0].name,$("#apexir_FILE_BUTTON").val("1"),$("#apexir_FILE_SELECTED").text(b)):($("#apexir_FILE_BUTTON").val(""),$("#apexir_FILE_SELECTED").text(c("WS_NO_FILE_CHOSEN")))})),t&&f()}