!function(a,b,c,d){"use strict";var e=".",f="a-Toolbar",g=f+"--small",h=f+"--simple",i=f+"-group",j=f+"-groupContainer",k=j+"--start",l=j+"--center",m=j+"--end",n=i+"--together",o=f+"-item",p=f+"-input",q=f+"-inputText",r=f+"-inputCheckbox",s=f+"-static",t=f+"-button",u=t+"-item",v=f+"-radioGroup",w=f+"-toggleButton",x=f+"-menu",y=f+"-selectList",z="a-Button",A=z+"--hot",B="a-Button-label",C="a-Button--withIcon",D="a-Button--noLabel",E="a-Icon",F=E+" icon-menu-drop-down",G="js-menuButton",H="js-actionButton",I="js-actionRadioGroup",J="js-actionCheckbox",K="js-actionSelect",L="is-active",M=e+p,N="start",O="center",P="end",Q=a.ui.keyCode;a.widget("apex.toolbar",{version:"5.1",widgetEventPrefix:"toolbar",options:{label:"",toolbarFor:null,idPrefix:null,actionsContext:null,small:!1,simple:!1,toolbarClass:"",cursorKeyNavigation:!1,data:[]},_create:function(){function c(b,c){"update"!==c&&"updateChoices"!==c||(k.enterActions[b.name]&&j.find('[data-enter-action="'+b.name+'"]').prop("disabled",!!b.disabled),j.is(":visible")&&j.find("."+i).each(function(){var b,c=a(this);b=c.children().filter(function(){return!this.style||"none"!==this.style.display}).length>0,c.toggle(b)}))}var e,j=this.element,k=this,l=this.options;e=b.debounce(c,10),this.menus={},this.enterActions={},this.nextId=1,j.addClass(f).attr("role","toolbar").attr("aria-label",l.label?l.label:d.formatMessage("APEX.TB.TOOLBAR")),l.toolbarFor&&j.attr("aria-controls",l.toolbarFor),l.small&&j.addClass(g),l.simple&&j.addClass(h),l.toolbarClass&&j.addClass(l.toolbarClass),apex.actions&&(this.actionsContext=l.actionsContext||apex.actions,this.actionsContext.observe(e),this.actionObserver=e),this.refresh(),l.cursorKeyNavigation&&(this.toolbarHasChanged(),this._on(this._keyNavHandlers))},_keyNavHandlers:{keydown:function(b){function c(a){var d,f;a.attr("tabindex","-1"),f=parseFloat(e.focusableElements.index(a[0])+1),d=f>=e.focusableElements.length?e.focusableElements.first():e.focusableElements.filter(":eq("+f+")"),a.is(":input[type=radio]")&&a.attr("name")===d.attr("name")?c(d):d.attr("tabindex","0").focus(),b.preventDefault()}function d(a){var c,f;a.attr("tabindex","-1"),f=parseFloat(e.focusableElements.index(a[0])-1),c=f<0?e.focusableElements.last():e.focusableElements.filter(":eq("+f+")"),a.is(":input[type=radio]")&&a.attr("name")===c.attr("name")?d(c):c.attr("tabindex","0").focus(),b.preventDefault()}var e=this,f=b.which,g=a(b.target);g.is(":input[type=text],:input[type=radio],select")?b.shiftKey&&f===Q.TAB?d(g):f===Q.TAB&&c(g):f===Q.LEFT?d(g):f===Q.RIGHT&&c(g)}},_destroy:function(){var b,c=this.element,d=this.options;c.removeClass(f+" "+g+" "+h+" "+d.toolbarClass).removeAttr("role").empty(),this.actionsContext&&this.actionsContext.unobserve(this.actionObserver);for(b in this.menus)this.menus.hasOwnProperty(b)&&a("#"+b).remove()},_setOption:function(a,b){var c=this.element;"small"===a&&c.toggleClass(g,b),"simple"===a&&c.toggleClass(h,b),"toolbarClass"===a&&c.removeClass(this.options.toolbarClass).addClass(b),this._super(a,b),"data"===a&&this.refresh()},_getControlProperty:function(a,b){var c,d;return d=a[b],void 0===d&&a.action&&(c=this.actionsContext.lookup(a.action),c&&c[b]&&(d=c[b])),d},_getLocalizedControlProperty:function(a,b){var c,e=null;return a[b+"Key"]?e=d.getMessage(a[b+"Key"]):void 0!==a[b]&&(e=a[b]),!e&&a.action&&(c=this.actionsContext.lookup(a.action),c&&void 0!==c[b]&&(e=c[b])),e},_getNoUpdate:function(a){return a.label||a.labelKey||a.icon||a.title||a.titleKey?"true":null},_getId:function(a){var b=this.options.idPrefix||this.element[0].id||"tb";return a.id?b+"_"+a.id:null},_forceId:function(a){a.id||(a.id="m"+this.nextId,this.nextId+=1)},_buildText:function(b,c){var d=a.extend({id:"",label:"",size:"30",maxChars:"4000",placeholder:"",action:""},c);d.enterAction&&(this.enterActions[d.enterAction]=!0),b.markup("<input").optionalAttr("id",this._getId(d)).attr("class",p+" "+q+" "+o).attr("title",this._getLocalizedControlProperty(d,"label")).attr("type","text").attr("size",d.size).attr("maxlength",d.maxChars).attr("value","").optionalAttr("placeholder",this._getLocalizedControlProperty(d,"placeholder")).optionalAttr("data-enter-action",d.enterAction).markup(" />")},_buildStatic:function(a,b){a.markup("<span").optionalAttr("id",this._getId(b)).attr("class",s+" "+o).markup(">"),b.content?a.markup(b.content):a.content(this._getLocalizedControlProperty(b,"label")),a.markup("</span>")},_buildSelect:function(a,b){var c,d=this.actionsContext.lookup(b.action);c=this._getLocalizedControlProperty(b,"title"),c||(c=this._getLocalizedControlProperty(b,"label")),a.markup("<select").optionalAttr("id",this._getId(b)).attr("class",y+" "+K+" "+o).attr("size","1").optionalAttr("title",c).optionalAttr("aria-label",c).optionalBoolAttr("disabled",d&&!!d.disabled).attr("data-action",b.action).markup("></select>")},_buildButton:function(a,b){function c(){a.markup("<span").attr("class",E+" "+f).markup("></span>")}var d,e,f,g,h,i=z+" "+o,j=b.menu||b.menuId;j?(b.menu?(this._forceId(b),d=this._getId(b)+"_menu"):d=b.menuId,i+=" "+G):i+=" "+H,f=this._getControlProperty(b,"icon"),f&&(i+=" "+C),b.iconOnly&&(i+=" "+D),b.hot&&(i+=" "+A),h=this.actionsContext.lookup(b.action),h&&h.get&&!h.onLabel&&h.get(b.action)&&(i+=" "+L),a.markup("<button type='button'").attr("class",i).optionalAttr("id",this._getId(b)).optionalBoolAttr("disabled",h&&!!h.disabled),e=this._getLocalizedControlProperty(b,"label"),g=this._getLocalizedControlProperty(b,"title"),!e&&h&&h.get&&(e=h.get()?h.onLabel:h.offLabel),b.iconOnly?(g||(g=e),a.attr("title",g).attr("aria-label",e)):g&&a.attr("title",g),j?a.attr("data-menu",d).attr("aria-haspopup",!0).attr("aria-expanded",!1):a.attr("data-action",b.action).optionalAttr("data-no-update",this._getNoUpdate(b)),a.markup(">"),f&&b.iconBeforeLabel&&c(),b.iconOnly||a.markup("<span class='"+B+"'>").content(e).markup("</span>"),f&&!b.iconBeforeLabel&&c(),j&&a.markup("<span").attr("class",F).markup("></span>"),a.markup("</button>"),b.menu&&(this.menus[d]=b.menu)},_buildRadioButtonGroup:function(a,b){a.markup("<div role='group'").attr("aria-label",this._getLocalizedControlProperty(b,"label")).attr("class",v+" "+I+" "+o).attr("data-action",b.action).attr("data-item",z).attr("data-item-wrap",u).markup("></div>")},_buildToggle:function(a,b){var c,d,e=this.actionsContext.lookup(b.action);this._forceId(b),c=e&&e.get(b.action),d=p+" "+r,c&&(d+=" "+L),a.markup("<div").attr("class",w+" "+J+" "+o).attr("data-action",b.action).optionalAttr("data-no-update",this._getNoUpdate(b)).markup(">"),a.markup("<input type='checkbox'").attr("class",d).attr("name",b.action).attr("id",this._getId(b)).optionalBoolAttr("checked",c).optionalBoolAttr("disabled",e&&!!e.disabled).markup(" />"),a.markup("<label").attr("for",this._getId(b)).attr("class",z).markup(">").content(this._getLocalizedControlProperty(b,"label")).markup("</label>"),a.markup("</div>")},_buildToolbar:function(a,b){var c,d=[],e=[],f=[];for(c=0;c<b.length;c++)b[c].align&&b[c].align!==N?b[c].align===O?e.push(b[c]):b[c].align===P&&f.push(b[c]):d.push(b[c]);d.length&&this._buildGroupContainer(a,N,d),e.length&&this._buildGroupContainer(a,O,e),f.length&&this._buildGroupContainer(a,P,f)},_buildGroupContainer:function(a,b,d){var e,f,g,h,o,p=j;switch(b){case N:p+=" "+k;break;case O:p+=" "+l;break;case P:p+=" "+m}for(a.markup("<div").attr("class",p).markup(">"),e=0;e<d.length;e++){for(o=i,g=d[e],g.customCSS&&(o+=" "+g.customCSS),g.groupTogether&&(o+=" "+n),a.markup("<div").attr("class",o).markup(">"),f=0;f<g.controls.length;f++)switch(h=g.controls[f],h.type){case"STATIC":this._buildStatic(a,h);break;case"TEXT":this._buildText(a,h);break;case"SELECT":this._buildSelect(a,h);break;case"MENU":case"BUTTON":this._buildButton(a,h);break;case"RADIO_GROUP":this._buildRadioButtonGroup(a,h);break;case"TOGGLE":this._buildToggle(a,h);break;default:c.error("Unknown toolbar control type: "+h.type)}a.markup("</div>")}a.markup("</div>")},refresh:function(){var c,d,e,f,g,h,i,j=this,k=this.element,l=this.options,m=l.data,n=b.htmlBuilder();for(g in this.menus)this.menus.hasOwnProperty(g)&&a("#"+g).remove();for(this._buildToolbar(n,l.data),k.html(n.toString()),c=0;c<m.length;c++)if(e=m[c].controls)for(d=0;d<e.length;d++)f=e[d],i=this.actionsContext.lookup(f.action),i&&(i.hide&&this.actionsContext.update(f.action),i.choices&&this.actionsContext.updateChoices(f.action));k.find(M).on("keydown",function(b){var c=a(b.target),d=c.attr("data-enter-action");d&&13===b.which&&(j.actionsContext.invoke(d),b.preventDefault())});for(g in this.menus)this.menus.hasOwnProperty(g)&&(a("<div/>",{id:g,"class":x,style:"display:none;"}).appendTo("body"),h=this.menus[g],h.actionsContext=this.actionsContext,h.idPrefix=this.options.idPrefix||this.element[0].id||"tb",a("#"+g).menu(h))},toolbarHasChanged:function(){var a,b;this.focusableElements=this.element.find(":focusable"),a=this.focusableElements.filter("[tabindex=0]"),b=a.length?this.focusableElements.index(a[0]):0,this.focusableElements.filter(":eq("+b+")").attr("tabindex","0").end().not(":eq("+b+")").attr("tabindex","-1")},hideControl:function(a){var b=this.find(a);b&&(b.action?this.actionsContext.hide(b.action):(this.findElement(a).hide(),this.actionObserver&&this.actionObserver({},"update")))},showControl:function(a){var b=this.find(a);b&&(b.action?this.actionsContext.show(b.action):(this.findElement(a).show(),this.actionObserver&&this.actionObserver({},"update")))},disableControl:function(a){var b=this.find(a);b&&(b.action?this.actionsContext.disable(b.action):this.findElement(a).prop("disabled",!0))},enableControl:function(a){var b=this.find(a);b&&(b.action?this.actionsContext.enable(b.action):this.findElement(a).prop("disabled",!1))},findGroup:function(a){var b,c,d=this.options.data;for(b=0;b<d.length;b++)if(c=d[b],c.id===a)return c;return null},find:function(b){var c,d,e,f,g,h=this.options.data;for(c=0;c<h.length;c++)if(e=h[c].controls)for(d=0;d<e.length;d++)if(f=e[d],f.id===b)return f;for(g in this.menus)if(this.menus.hasOwnProperty(g)&&(f=a("#"+g).menu("find",b)))return f;return null},findElement:function(b){var c,d=this._getId({id:b});return c=a("#"+d)}})}(apex.jQuery,apex.util,apex.debug,apex.lang);