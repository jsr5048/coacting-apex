!function(d3){function transitionEndSignaler(){var callback,queued=0;return{callback:function(cb){callback=cb},add:function(){queued++},remove:function(){0===--queued&&callback&&callback()}}}!d3.oracle&&(d3.oracle={});var TICK_FACTOR_Y=1.1,X_TICK_SPACING=10,Y_TICK_SPACING=25,MAX_TIME_DIFFERENCE=200,CSS_CLASS_PREFIX="a-D3LineChart";d3.oracle.linechart=function(){function _detach(bbox){return{x:bbox.x,y:bbox.y,width:bbox.width,height:bbox.height}}function _transformDomain(d,axis){return"x"==axis?[d[0],d[1]]:d[0]<0&&d[1]<0?[d[0]*TICK_FACTOR_Y,0]:d[0]>0&&d[1]>0?[0,d[1]*TICK_FACTOR_Y]:[d[0]*TICK_FACTOR_Y,d[1]*TICK_FACTOR_Y]}function _getMinimumTimeScaleDifference(timeDifference,divideBy,initialDate,finalDate){if(MAX_TIME_DIFFERENCE>=timeDifference)return{"function":divideBy,difference:Math.round(timeDifference)};switch(divideBy){case d3.time.minute:return _getMinimumTimeScaleDifference(timeDifference/60,d3.time.hour,initialDate,finalDate);case d3.time.hour:return _getMinimumTimeScaleDifference(timeDifference/60,d3.time.day,initialDate,finalDate);case d3.time.day:return _getMinimumTimeScaleDifference(timeDifference/24,d3.time.week,initialDate,finalDate);case d3.time.week:return _getMinimumTimeScaleDifference(timeDifference/7,d3.time.month,initialDate,finalDate);case d3.time.month:var monthDifference;return monthDifference=12*(finalDate.getFullYear()-initialDate.getFullYear()),monthDifference-=initialDate.getMonth()+1,monthDifference+=finalDate.getMonth(),_getMinimumTimeScaleDifference(0>=monthDifference?0:monthDifference,d3.time.year,initialDate,finalDate);case d3.time.year:return _getMinimumTimeScaleDifference(finalDate.getFullYear()-initialDate.getFullYear(),d3.time.year,initialDate,finalDate);default:return{"function":divideBy,difference:Math.round(finalDate.getFullYear()-initialDate.getFullYear())}}}function _sortXDates(element){element.points.sort(function(a,b){return parseFloat(accessors.x(a).getTime())-parseFloat(accessors.x(b).getTime())})}function _stackAccessorScale(d){return yScale(d.y0)}function _stackAccessor(d){return d.y0}function _x(d,i,j){return changeXScale?xScaleCopy(accessors.x(d)):xScale(accessors.x(d))}function _xGetter(scale){return function(){return scale(accessors.x.apply(this,arguments))}}function _yGetter(scale){return function(){return scale(accessors.y.apply(this,arguments)+("stacked"===display?_stackAccessor.apply(this,arguments):0))}}function _stackGetter(scale){return function(){return scale(_stackAccessor.apply(this,arguments))}}function _y(d,i,j){return yScale("stacked"==display?accessors.y(d)+_stackAccessor(d):accessors.y(d))}function _errorLog(e){throw"Insufficient data to handle."}function exports(_selection){_selection.each(function(data){function tsAdd(){ts.add.apply(this,arguments)}function tsRem(){ts.remove.apply(this,arguments)}function _rescale(){chartW=width-actualMargin.left-actualMargin.right,"chart"===heightMode?chartH=iHeight-actualMargin.top-actualMargin.bottom:(chartH=height,iHeight=height+actualMargin.top+actualMargin.bottom),changeXScale?xScaleCopy.range([0,chartW]):null,xScale.range([0,chartW]),yScale.range([chartH,0])}function _drawHAxis(staged,rotate,rotateDeg){if(void 0===rotateDeg&&(rotateDeg=-45),hAxisArea=svg.select("."+CSS_CLASS_PREFIX+"-axis--h"),xAxis.display){(hAxisArea.empty()||staged)&&(hAxisArea=svg.append("g").classed(CSS_CLASS_PREFIX+"-axis",!0).classed(CSS_CLASS_PREFIX+"-axis--h",!0).attr({transform:"translate("+actualMargin.left+","+(actualMargin.top+chartH)+")",width:chartW,height:actualMargin.bottom})),hAxisArea.classed(CSS_CLASS_PREFIX+"-axis--staging",staged);var hAxisAreaT=hAxisArea;if(transitions.enable&&!staged&&(hAxisAreaT=hAxisArea.transition().duration(transitions.duration).ease(transitions.smoothing).each(tsAdd).each("end.ts",tsRem)),showXTicks){if(hAxisGenerator=d3.svg.axis().orient("bottom").scale(xScale).tickFormat(d3.functor(xAxis.formatter)).tickSize(showXTicks?-chartH:0),timeData&&!xAxis.ticks){var timeDifferenceSeconds=Math.round(Math.abs(xDomain[1].getTime()-xDomain[0].getTime())/1e3);if("auto"==xAxis.ticksInterval){var minimumTimeDifference=_getMinimumTimeScaleDifference(timeDifferenceSeconds,d3.time.minute,xDomain[0],xDomain[1]),tickSeparation=Math.round(minimumTimeDifference.difference/Math.floor(chartW/X_TICK_SPACING));0>=tickSeparation?tickSeparation=1:null,hAxisGenerator.tickValues(minimumTimeDifference["function"].range(xDomain[0],xDomain[1]).filter(function(d,i){return!(i%tickSeparation)}))}else"auto"!=xAxis.ticksInterval&&hAxisGenerator.ticks(xAxis.ticksInterval,xAxis.ticksIntervalStep)}else xAxis.ticks&&hAxisGenerator.ticks.apply(hAxisGenerator,xAxis.ticks);hAxisAreaT.attr({transform:"translate("+actualMargin.left+","+(actualMargin.top+chartH)+")",width:chartW,height:actualMargin.bottom}).call(hAxisGenerator)}rotate?hAxisAreaT.selectAll(".tick text").style("text-anchor","end").attr("transform",function(){return-45==rotateDeg?"translate("+.6*-_detach(this.getBBox()).height+",8.5) rotate("+rotateDeg+")":"translate("+.75*-_detach(this.getBBox()).height+",8) rotate("+rotateDeg+")"}):hAxisAreaT.selectAll(".tick text").style("text-anchor","middle").attr("transform","translate(0, 8.5) rotate(0)");var hAxisTitle=hAxisArea.select("."+CSS_CLASS_PREFIX+"-axis-title");if(xAxis.title){hAxisTitle.empty()&&(hAxisTitle=hAxisArea.append("text").style({"text-anchor":"middle"}).attr({transform:"translate("+chartW/2+","+(actualMargin.bottom-5)+")",opacity:0}).classed(CSS_CLASS_PREFIX+"-axis-title",!0)),hAxisTitle.text(xAxis.title);var hAxisTitleT=hAxisTitle;transitions.enable&&!staged&&(hAxisTitleT=hAxisTitle.transition().duration(transitions.duration).ease(transitions.smoothing).each(tsAdd).each("end.ts",tsRem)),hAxisTitleT.attr({transform:"translate("+chartW/2+","+(actualMargin.bottom-5)+")",opacity:staged?0:1})}else transitions.enable&&!staged?hAxisTitle.transition().duration(transitions.duration).ease(transitions.smoothing).attr({opacity:0}).each("end",function(){d3.select(this).remove()}).each(tsAdd).each("end.ts",tsRem):hAxisTitle.remove()}else transitions.enable&&!staged?hAxisArea.transition().ease(transitions.smoothing).duration(transitions.duration).attr({opacity:0}).each("end",function(){hAxisArea.attr({opacity:1}).html("")}).each(tsAdd).each("end.ts",tsRem):hAxisArea.html("")}function _drawVAxis(staged){if(vAxisArea=svg.select("."+CSS_CLASS_PREFIX+"-axis--v"),yAxis.display){if((vAxisArea.empty()||staged)&&(vAxisArea=svg.append("g").classed(CSS_CLASS_PREFIX+"-axis",!0).classed(CSS_CLASS_PREFIX+"-axis--v",!0).attr({width:actualMargin.left,height:chartH,transform:"translate("+actualMargin.left+","+actualMargin.top+")"})),vAxisArea.classed(CSS_CLASS_PREFIX+"-axis--staging",staged),showYTicks){var vAxisAreaT=vAxisArea;transitions.enable&&!staged&&(vAxisAreaT=vAxisArea.transition().ease(transitions.smoothing).duration(transitions.duration).each(tsAdd).each("end.ts",tsRem)),vAxisAreaT.attr({width:actualMargin.left,height:chartH,transform:"translate("+actualMargin.left+","+actualMargin.top+")"});var yAxisGenerator=d3.svg.axis().orient("left").scale(yScale);"auto"===yAxis.ticks?yAxisGenerator.tickFormat(d3.functor(yAxis.formatter)).tickSize(showYTicks?-chartW:0).ticks(Math.floor(chartH/Y_TICK_SPACING)):yAxis.ticks?yAxisGenerator.ticks.apply(yAxisGenerator,yAxis.ticks):yAxisGenerator.tickFormat(d3.functor(yAxis.formatter)).tickSize(showYTicks?-chartW:0),vAxisAreaT.call(yAxisGenerator)}var vAxisTitle=vAxisArea.select("."+CSS_CLASS_PREFIX+"-axis-title");if(yAxis.title){vAxisTitle.empty()&&(vAxisTitle=vAxisArea.append("text").style({"text-anchor":"middle"}).attr({opacity:0,transform:"translate("+-1*(actualMargin.left-20)+","+chartH/2+") rotate(-90)"}).classed(CSS_CLASS_PREFIX+"-axis-title",!0)),vAxisTitle.text(yAxis.title),vAxisArea.selectAll(".tick text").attr("transform",function(){return"translate("+.2*-_detach(this.getBBox()).width+", 0)"});var vAxisTitleT=vAxisTitle;transitions.enable&&!staged&&(vAxisTitleT=vAxisTitle.transition().ease(transitions.smoothing).duration(transitions.duration).each(tsAdd).each("end.ts",tsRem)),vAxisTitleT.attr({transform:"translate("+-1*(actualMargin.left-20)+","+chartH/2+") rotate(-90)",opacity:staged?0:1})}else transitions.enable&&!staged?vAxisTitle.transition().ease(transitions.smoothing).duration(transitions.duration).attr({opacity:0}).each("end",function(){d3.select(this).remove()}).each(tsAdd).each("end.ts",tsRem):vAxisTitle.remove()}else transitions.enable&&!staged?vAxisArea.transition().ease(transitions.smoothing).duration(transitions.duration).attr({opacity:0}).each("end",function(){vAxisArea.attr({opacity:1}).html("")}).each(tsAdd).each("end.ts",tsRem):vAxisArea.html("")}function _draw(dataSet,scales,doTransitions,offset){scales=scales||{},scales.x=scales.x||xScale,scales.y=scales.y||yScale,offset=offset||{},offset.x=offset.x||0,offset.y=offset.y||0;var areaContainerAll=chartArea.select("."+CSS_CLASS_PREFIX+"-areaContainerAll");areaContainerAll.empty()&&(areaContainerAll=chartArea.append("svg").classed(CSS_CLASS_PREFIX+"-areaContainerAll",!0).attr({width:chartW,height:chartH})),(doTransitions?areaContainerAll.transition().duration(transitions.duration).ease(transitions.smoothing).each(tsAdd).each("end.ts",tsRem):areaContainerAll).attr({width:chartW,height:chartH});var lineContainerAll=chartArea.select("."+CSS_CLASS_PREFIX+"-lineContainerAll");lineContainerAll.empty()&&(lineContainerAll=chartArea.append("svg").classed(CSS_CLASS_PREFIX+"-lineContainerAll",!0).attr({width:chartW,height:chartH})),(doTransitions?lineContainerAll.transition().duration(transitions.duration).ease(transitions.smoothing).each(tsAdd).each("end.ts",tsRem):lineContainerAll).attr({width:chartW,height:chartH});var pointContainerAll=chartArea.select("."+CSS_CLASS_PREFIX+"-pointContainerAll");pointContainerAll.empty()&&(pointContainerAll=chartArea.append("svg").classed(CSS_CLASS_PREFIX+"-pointContainerAll",!0)),(doTransitions?pointContainerAll.transition().duration(transitions.duration).ease(transitions.smoothing).each(tsAdd).each("end.ts",tsRem):pointContainerAll).attr({width:chartW,height:chartH});var areas=areaContainerAll.selectAll("."+CSS_CLASS_PREFIX+"-area").data(dataSet,function(d){return d.series}),pointContainers=pointContainerAll.selectAll("."+CSS_CLASS_PREFIX+"-pointContainer").data(dataSet,function(d){return d.series}),lines=lineContainerAll.selectAll("."+CSS_CLASS_PREFIX+"-line").data(dataSet,function(d){return d.series}),xGet=_xGetter(scales.x),yGet=_yGetter(scales.y),lineGenerator=d3.svg.line().x(xGet).y(yGet).interpolate(lineInterpolation),lineEnterGenerator=d3.svg.line().x(xGet).y(scales.y(0)).interpolate(lineInterpolation);areas.enter().append("path").classed(CSS_CLASS_PREFIX+"-area",!0).attr({d:"stacked"===display?function(d){return lineEnterGenerator(d.points)}:function(d){var path=lineEnterGenerator(d.points);return"M"+xGet(d.points[d.points.length-1])+" "+scales.y(0)+"L"+xGet(d.points[0])+" "+scales.y(0)+path.replace("M","L")+"Z"},"fill-opacity":0}).style({fill:accessors.color}),lines.enter().append("path").classed(CSS_CLASS_PREFIX+"-line",!0).attr({d:function(d){return lineEnterGenerator(d.points)},fill:"none","stroke-width":1,opacity:0}).style({stroke:accessors.color}),pointContainers.enter().append("g").classed(CSS_CLASS_PREFIX+"-pointContainer",!0).attr("data-series",accessors.series);var points=pointContainers.selectAll("."+CSS_CLASS_PREFIX+"-pointContainer-dot").data(function(d){return d.points},accessors.key||void 0);points.enter().append("circle").classed(CSS_CLASS_PREFIX+"-pointContainer-dot",!0).attr({r:0,cx:xGet,cy:scales.y(0),"stroke-width":0,"fill-opacity":0,tabindex:-1}).style({fill:accessors.color,stroke:accessors.color}).on("mouseenter",function(){dispatch.pointenter.apply(this,arguments)}).on("focus",function(){dispatch.pointfocus.apply(this,arguments)}).on("mousemove",function(){dispatch.pointover.apply(this,arguments)}).on("mouseleave",function(){dispatch.pointleave.apply(this,arguments)}).on("blur",function(){dispatch.pointblur.apply(this,arguments)}).on("click",function(){dispatch.pointclick.apply(this,arguments)});var dotRadiusCurrent;"auto"==dotRadius.size?(dotRadiusCurrent=chartW/(d3.max(dataSet,function(d){return d.points.length})||0)||0*dotRadius.spacing,dotRadiusCurrent>dotRadius.max?dotRadiusCurrent=dotRadius.max:dotRadiusCurrent<dotRadius.min?dotRadiusCurrent=dotRadius.min:null):dotRadiusCurrent=dotRadius.size,points.each(function(d){d.$radius=dotRadiusCurrent});var linesT=lines,areasT=areas,pointsT=points;if(doTransitions&&(linesT=lines.transition().duration(transitions.duration).ease(transitions.smoothing).each(tsAdd).each("end.ts",tsRem),areasT=areas.transition().duration(transitions.duration).ease(transitions.smoothing).each(tsAdd).each("end.ts",tsRem),pointsT=points.transition().duration(transitions.duration).ease(transitions.smoothing).each(tsAdd).each("end.ts",tsRem)),"stacked"==display){var stackGet=_stackGetter(scales.y),areaGenerator=d3.svg.area().x(xGet).y0(stackGet).y1(yGet).interpolate(lineInterpolation);areasT.attr({d:function(d){var path=areaGenerator(d.points);return path},"fill-opacity":.3,transform:"translate("+offset.x+","+offset.y+")"}).style({fill:accessors.color})}else areasT.attr({d:function(d){var path=lineGenerator(d.points);return"M"+xGet(d.points[d.points.length-1])+" "+scales.y(0)+"L"+xGet(d.points[0])+" "+scales.y(0)+path.replace("M","L")+"Z"},"fill-opacity":.3,transform:"translate("+offset.x+","+offset.y+")"}).style({fill:accessors.color});linesT.attr({d:function(d){return lineGenerator(d.points)},"stroke-width":1,fill:"none",opacity:1,transform:"translate("+offset.x+","+offset.y+")"}).style({stroke:accessors.color}),pointsT.attr({r:dotRadiusCurrent,cx:xGet,cy:yGet,"stroke-width":2,"fill-opacity":1,transform:"translate("+offset.x+","+offset.y+")"}).style({fill:accessors.color,stroke:accessors.color}),doTransitions?(lines.exit().transition().duration(transitions.duration).ease(transitions.smoothing).attr({opacity:0}).each("end",function(){d3.select(this).remove()}).each(tsAdd).each("end.ts",tsRem),areas.exit().transition().duration(transitions.duration).ease(transitions.smoothing).attr({"fill-opacity":0}).each("end",function(){d3.select(this).remove()}).each(tsAdd).each("end.ts",tsRem),pointContainers.exit().transition().duration(transitions.duration).ease(transitions.smoothing).attr({opacity:0}).each("end",function(){d3.select(this).remove()}).each(tsAdd).each("end.ts",tsRem),points.exit().transition().duration(transitions.duration).ease(transitions.smoothing).attr({opacity:0}).each("end",function(){d3.select(this).remove()}).each(tsAdd).each("end.ts",tsRem)):(lines.exit().remove(),areas.exit().remove(),pointContainers.exit().remove(),points.exit().remove())}function _drawCompleteLine(dataSet,oldData,transitionEnable){var areaContainerAll=chartArea.select("."+CSS_CLASS_PREFIX+"-areaContainerAll");areaContainerAll.empty()&&(areaContainerAll=chartArea.append("svg").classed(CSS_CLASS_PREFIX+"-areaContainerAll",!0).attr({width:chartW,height:chartH})),(transitions.enable?areaContainerAll.transition().ease(transitions.smoothing).duration(transitions.duration).each(tsAdd).each("end.ts",tsRem):areaContainerAll).attr({width:chartW,height:chartH});var lineContainerAll=chartArea.select("."+CSS_CLASS_PREFIX+"-lineContainerAll");lineContainerAll.empty()&&(lineContainerAll=chartArea.append("svg").classed(CSS_CLASS_PREFIX+"-lineContainerAll",!0).attr({width:chartW,height:chartH})),(transitions.enable?lineContainerAll.transition().ease(transitions.smoothing).duration(transitions.duration).each(tsAdd).each("end.ts",tsRem):lineContainerAll).attr({width:chartW,height:chartH});var pointContainerAll=chartArea.select("."+CSS_CLASS_PREFIX+"-pointContainerAll");pointContainerAll.empty()&&(pointContainerAll=chartArea.append("g").classed(CSS_CLASS_PREFIX+"-pointContainerAll",!0)),(transitions.enable?pointContainerAll.transition().ease(transitions.smoothing).duration(transitions.duration).each(tsAdd).each("end.ts",tsRem):pointContainerAll).attr({width:chartW,height:chartH});var area=areaContainerAll.selectAll("."+CSS_CLASS_PREFIX+"-area").data(oldData?dataSet:formattedDataLine,function(d){return d.series}),pointContainer=pointContainerAll.selectAll("."+CSS_CLASS_PREFIX+"-pointContainer").data(dataSet,function(d){return d.series}),lines=lineContainerAll.selectAll("."+CSS_CLASS_PREFIX+"-line").data(oldData?dataSet:formattedDataLine,function(d){return d.series}),line=d3.svg.line().x(_x).y(_y).interpolate(lineInterpolation),lineEnter=d3.svg.line().x(_x).y(yScale(0)).interpolate(lineInterpolation);"stacked"==display?area.enter().append("path").classed(CSS_CLASS_PREFIX+"-area",!0).attr({d:function(d){return lineEnter(d.points)},"fill-opacity":0}).style({fill:accessors.color}):area.enter().append("path").classed(CSS_CLASS_PREFIX+"-area",!0).attr({d:function(d){var path=lineEnter(d.points);return"M"+_x(d.points[d.points.length-1])+" "+yScale(0)+"L"+_x(d.points[0])+" "+yScale(0)+path.replace("M","L")+"Z"},"fill-opacity":0}).style({fill:accessors.color}),lines.enter().append("path").classed(CSS_CLASS_PREFIX+"-line",!0).attr({d:function(d){return lineEnter(d.points)},fill:"none","stroke-width":1,opacity:0}).style({stroke:accessors.color}),pointContainer.enter().append("g").classed(CSS_CLASS_PREFIX+"-pointContainer",!0).attr("data-series",accessors.series);var points=pointContainer.selectAll("."+CSS_CLASS_PREFIX+"-pointContainer-dot").data(function(d){return d.points},accessors.key||void 0);if(points.enter().append("circle").classed(CSS_CLASS_PREFIX+"-pointContainer-dot",!0).attr({r:0,cx:_x,cy:yScale(0),"stroke-width":0,"fill-opacity":0,tabindex:-1}).style({fill:accessors.color,stroke:accessors.color}).on("mouseenter",function(d){dispatch.pointenter.apply(this,arguments)}).on("focus",function(d){dispatch.pointfocus.apply(this,arguments)}).on("mousemove",function(d){dispatch.pointover.apply(this,arguments)}).on("mouseleave",function(d){dispatch.pointleave.apply(this,arguments)}).on("blur",function(d){dispatch.pointblur.apply(this,arguments)}).on("click",function(d){dispatch.pointclick.apply(this,arguments)}),"auto"==dotRadius.size){var dotRadiusCurrent=chartW/(d3.max(dataSet,function(d){return d.points.length})||0)||0*dotRadius.spacing;dotRadiusCurrent>dotRadius.max?dotRadiusCurrent=dotRadius.max:dotRadiusCurrent<dotRadius.min?dotRadiusCurrent=dotRadius.min:null,points.each(function(d){d.$radius=dotRadiusCurrent})}else{var dotRadiusCurrent=dotRadius.size;points.each(function(d){d.$radius=dotRadiusCurrent})}var linesT=lines,areaT=area,pointsT=points;if(transitions.enable&&transitionEnable&&(linesT=lines.transition().ease(transitions.smoothing).duration(transitions.duration).each(tsAdd).each("end.ts",tsRem),areaT=area.transition().ease(transitions.smoothing).duration(transitions.duration).each(tsAdd).each("end.ts",tsRem),pointsT=points.transition().ease(transitions.smoothing).duration(transitions.duration).each(tsAdd).each("end.ts",tsRem)),"stacked"==display){var d3area=d3.svg.area().interpolate(lineInterpolation).x(_x).y0(function(d){return _stackAccessorScale(d)}).y1(_y);areaT.attr({d:function(d){var path=d3area(d.points);return path},"fill-opacity":.3}).style({fill:accessors.color})}else areaT.attr({d:function(d){var path=line(d.points);return"M"+_x(d.points[d.points.length-1])+" "+yScale(0)+"L"+_x(d.points[0])+" "+yScale(0)+path.replace("M","L")+"Z"},"fill-opacity":.3}).style({fill:accessors.color});linesT.attr({d:function(d){return line(d.points)},"stroke-width":1,fill:"none",opacity:1}).style({stroke:accessors.color}),pointsT.attr({r:dotRadiusCurrent,cx:_x,cy:_y,"stroke-width":2,"fill-opacity":1}).style({fill:accessors.color,stroke:accessors.color}),transitions.enable?(lines.exit().transition().ease(transitions.smoothing).duration(transitions.duration).attr({opacity:0}).each("end",function(){d3.select(this).remove()}).each(tsAdd).each("end.ts",tsRem),area.exit().transition().ease(transitions.smoothing).duration(transitions.duration).attr({"fill-opacity":0}).each("end",function(){d3.select(this).remove()}).each(tsAdd).each("end.ts",tsRem),pointContainer.exit().transition().ease(transitions.smoothing).duration(transitions.duration).attr({opacity:0}).each("end",function(){d3.select(this).remove()}).each(tsAdd).each("end.ts",tsRem),points.exit().transition().ease(transitions.smoothing).duration(transitions.duration).attr({opacity:0}).each("end",function(){d3.select(this).remove()}).each(tsAdd).each("end.ts",tsRem)):(lines.exit().remove(),area.exit().remove(),pointContainer.exit().remove(),points.exit().remove())}xScale=timeData?d3.time.scale():d3.scale.linear();var self=d3.select(this),ts=transitionEndSignaler();ts.callback(function(){dispatch.transitionend.apply(self[0][0])});var chartW,chartH,actualMargin={};for(var k in margin)"auto"==margin[k]?actualMargin[k]=10:actualMargin[k]=margin[k];var iHeight=height,jql=oracle.jql().select([function(rows){return rows},"points"]).from(data).group_by([accessors.series],"series");formattedData=jql();var yDomain,xDomain,formattedDataLine=jql();formattedData.length;if("stacked"==display){stackLayout.values(function(d){return d.points}).x(accessors.x).y(accessors.y);try{stackLayout(formattedData),stackLayout(formattedDataLine)}catch(e){_errorLog(e)}var maxY=d3.max(formattedData,function(s){return d3.max(s.points,function(d){return accessors.y(d)+(_stackAccessor(d)||0)})}),minY=d3.min(formattedData,function(s){return d3.min(s.points,function(d){return accessors.y(d)+(_stackAccessor(d)||0)})});yDomain=yAxis.domain||_transformDomain([minY,maxY],"y")}else yDomain=yAxis.domain||_transformDomain(d3.extent(data,accessors.y),"y");xDomain=xAxis.domain||(timeData?d3.extent(data,accessors.x):_transformDomain(d3.extent(data,accessors.x),"x")),xScale.domain(xDomain),yScale.domain(yDomain);var svg=self.select("."+CSS_CLASS_PREFIX+"-svg");svg.empty()&&(svg=self.append("svg").classed(""+CSS_CLASS_PREFIX+"-svg",!0).on("focus",function(d){dispatch.chartfocus.apply(this,arguments)}).on("blur",function(d){dispatch.chartblur.apply(this,arguments)}).attr({width:width,height:height}));var oldData=svg.selectAll("."+CSS_CLASS_PREFIX+"-line").data();if(oldData.length>0&&formattedDataLine.forEach(function(element,index,array){if(index<=oldData.length-1){var elementLength=element.points.length,oldDataLength=oldData[index].points.length;if(elementLength>oldDataLength)for(i=oldDataLength;elementLength>i;i++)oldData[index].points.push(oldData[index].points[oldDataLength-1]);else for(i=elementLength;oldDataLength>i;i++)formattedDataLine[index].points.push(formattedDataLine[index].points[elementLength-1])}}),_rescale(),"auto"==margin.left&&yAxis.display){_drawVAxis(!0);var maxTickWidth=0;vAxisArea.selectAll(".tick text").each(function(){maxTickWidth=Math.max(maxTickWidth,_detach(this.getBBox()).width)});var titleHeight=0,hTitle=vAxisArea.select("."+CSS_CLASS_PREFIX+"-axis-title");hTitle.empty()||(titleHeight=_detach(hTitle[0][0].getBBox()).height),actualMargin.left=maxTickWidth+15+(titleHeight>0?titleHeight+10:0),_rescale(),vAxisArea.remove()}var mustRotateH=!1,mustRotateDegrees=-45;if("auto"==margin.bottom&&xAxis.display){_drawHAxis(!0);var maxTickHeight=0,bboxes=[];hAxisArea.selectAll(".tick text").each(function(){maxTickHeight=Math.max(maxTickHeight,_detach(this.getBBox()).height)}),maxTickHeight+=5,hAxisArea.selectAll(".tick").each(function(d){var box=_detach(this.getBBox()),innerBox=_detach(d3.select(this).select("text")[0][0].getBBox());box.height=innerBox.height,box.width=innerBox.width,box.x=xScale(d)-box.width/2,bboxes.push(box)});for(var i=1;i<bboxes.length;i++)if(bboxes[i-1].x+bboxes[i-1].width+5>bboxes[i].x){hAxisArea.remove(),_drawHAxis(!0,mustRotateH=!0),maxTickHeight=d3.max(bboxes,function(d){return d.width})||0,maxTickHeight=(maxTickHeight+bboxes[i].height)*Math.sin(Math.PI/4)+5;for(var i=0;i<bboxes.length;i++)if(bboxes[i].x=bboxes[i].x+bboxes[i].width/2,i>0&&bboxes[i-1].x+bboxes[i-1].height*Math.sqrt(2)>bboxes[i].x){hAxisArea.remove(),_drawHAxis(!0,mustRotateH=!0,mustRotateDegrees=-90),maxTickHeight=(d3.max(bboxes,function(d){return d.width})||0)+10;break}break}var titleHeight=0,hTitle=hAxisArea.select("."+CSS_CLASS_PREFIX+"-axis-title");hTitle.empty()||(titleHeight=_detach(hTitle[0][0].getBBox()).height),actualMargin.bottom=maxTickHeight+(titleHeight>0?titleHeight+2.5:0)+10,_rescale(),hAxisArea.remove()}_drawVAxis(!1),_drawHAxis(!1,mustRotateH,mustRotateDegrees),(transitions.enable?svg.transition().duration(transitions.duration).ease(transitions.smoothing).each(tsAdd).each("end.ts",tsRem):svg).attr({width:width,height:iHeight});var hAxisArea,hAxisGenerator,vAxisArea,chartArea=svg.select("."+CSS_CLASS_PREFIX+"-chartArea");chartArea.empty()&&(chartArea=svg.append("g").classed(CSS_CLASS_PREFIX+"-chartArea",!0).attr({width:chartW,height:chartH,transform:"translate("+actualMargin.left+","+actualMargin.top+")"})),(transitions.enable?chartArea.transition().duration(transitions.duration).ease(transitions.smoothing).each(tsAdd).each("end.ts",tsRem):chartArea).attr({width:chartW,height:chartH,transform:"translate("+actualMargin.left+","+actualMargin.top+")"}),timeData&&(oldData.forEach(_sortXDates),formattedData.forEach(_sortXDates),formattedDataLine.forEach(_sortXDates)),"stream"===chart.mode?(xScaleOld=xScaleOld||xScale,yScaleOld=yScaleOld||yScale,_draw(formattedData,{x:xScaleOld,y:yScaleOld},!1),_draw(formattedData,{x:xScale,y:yScale},transitions.enable),xScaleOld=xScale.copy(),yScaleOld=yScale.copy()):(_drawCompleteLine(oldData,!0,!1),changeXScale=!1,_drawCompleteLine(formattedData,!1,!0),xScaleCopy=xScale.copy(),changeXScale=!0)})}function _getObjectSetterGetter(obj){return function(prop,x){if(void 0===x&&void 0===prop)return obj;if(void 0===x&&"string"==typeof prop)return obj[prop];if("object"==typeof prop)for(var k in prop)obj[k]=prop[k];else obj[prop]=x;return exports}}var xScaleCopy,xScaleOld,yScaleOld,formattedData,dispatch=d3.dispatch("pointenter","pointover","pointleave","pointclick","pointfocus","pointblur","chartfocus","chartblur","transitionend"),margin={top:10,left:"auto",right:20,bottom:"auto"},width=1e3,height=400,xAxis={display:!0,title:"Interest",formatter:function(v){return v},ticksInterval:"auto",ticksIntervalDefault:d3.time.day,ticksIntervalStep:3,ticks:null,domain:null},yAxis={display:!0,title:"Money",formatter:d3.oracle.fnf(),ticks:null,domain:null},display="overlap",stackLayout=d3.layout.stack(),dotRadius={max:3.5,min:1,size:3.5,spacing:.6},chart={mode:"normal"},changeXScale=!1,xFormatter=null,heightMode="chart",lineInterpolation="linear",timeData=!1,showXTicks=!0,showYTicks=!0,xScale=timeData?d3.time.scale():d3.scale.linear(),yScale=d3.scale.linear(),accessors={x:function(d){return timeData?new Date(d.x):parseFloat(d.x)},y:function(d){return d.y},series:function(d){return d.series},color:function(d){return d.color},key:null},sortPoints={sortX:timeData},showAxis={showXAxis:!0,showYAxis:!0},transitions={enable:!0,smoothing:"cubic-in-out",duration:1e3};return exports.margin=_getObjectSetterGetter(margin),exports.dotRadius=_getObjectSetterGetter(dotRadius),exports.accessors=_getObjectSetterGetter(accessors),exports.sortPoints=_getObjectSetterGetter(sortPoints),exports.showAxis=_getObjectSetterGetter(showAxis),exports.transitions=_getObjectSetterGetter(transitions),exports.xAxis=_getObjectSetterGetter(xAxis),exports.yAxis=_getObjectSetterGetter(yAxis),exports.chart=_getObjectSetterGetter(chart),exports.width=function(x){return void 0===x?width:(width=x,exports)},exports.height=function(x){return void 0===x?height:(height=x,exports)},exports.timeData=function(x){return void 0===x?timeData:(timeData=x,exports)},exports.xFormatter=function(x){return void 0===x?xFormatter:(xFormatter=d3.functor(x),exports)},exports.lineInterpolation=function(x){return void 0===x?lineInterpolation:(lineInterpolation=x,exports)},exports.heightMode=function(x){return void 0===x?heightMode:(heightMode=x,exports)},exports.showXTicks=function(x){return void 0===x?showXTicks:(showXTicks=x,exports)},exports.showYTicks=function(x){return void 0===x?showYTicks:(showYTicks=x,exports)},exports.display=function(x){return void 0===x?display:(display=x,exports)},d3.rebind(exports,dispatch,"on"),exports}}(window.d3);